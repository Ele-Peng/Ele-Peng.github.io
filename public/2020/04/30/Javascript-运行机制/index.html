<!DOCTYPE html>
<html lang="zh">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="theme-color" content=#58b77a>
  <title>ã€æœªå®Œã€‘Javascript-è¿è¡Œæœºåˆ¶ï¼ˆä¸€ï¼‰ | Be kind.</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="author" content="EllePeng">
  <meta name="keywords" content="">
  <meta name="description" content="">
  <script id="hexo-configurations">
  var CONFIG = {
    root: '/',
    theme: 'hexo-theme-lx',
    version: '0.3.9',
    localsearch:{
      "enable": true,
      "trigger": "auto",
      "top_n_per_article": 1,
      "unescape": false,
      "preload": false
      },
    path: 'search.xml'
  };
</script>

  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/css/main.min.css">
  <style type="text/css">
    pre,
    code {
      font-family: 'Fira Code', monospace;
    }
    html {
      font-family: sans-serif;
    }
    body {
      font-family: sans-serif;
    }
    h1, h2, h3, h4, h5, figure {
      font-family: sans-serif;
    }
    .menu-container{
      font-family: sans-serif;
    }
  </style>

  <script src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/jquery.jside.menu.js"></script>
	<script>
	$(document).ready(function(){
	$(".menu-container").jSideMenu({
	    jSidePosition: "position-right",
	    jSideSticky: true,
	    jSideSkin: "greenish",
	     });
	}); 
	</script>
  
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Fira Code:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4/css/font-awesome.min.css">
<meta name="generator" content="Hexo 4.2.1"></head>
<body>
<div class="single">
<a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i></a>
<div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Search..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>

<div id="page">
<div id="lx-aside" style="background-image: url(//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/images/post_cover.jpeg)" data-stellar-background-ratio="0.5">
  <div class="overlay">
  <div class="page-title">
    <div class="avatar"><a href="/"><img src="/images/avatar.jpeg"></a></div>
    <span>2020-04-30</span>
    <h2>ã€æœªå®Œã€‘Javascri...</h2>
    <div class="tags"><i class="fa fa-tag"></i><a class="tag-link" href="/tags/%E5%89%8D%E7%AB%AF%E6%A6%82%E5%BF%B5/" rel="tag">å‰ç«¯æ¦‚å¿µ</a></div>
    <div class="social-links">
    <a href="https://github.com/Ele-Peng" target="_blank"><i class="fa fa-github fa-fw"></i></a>
    <a href="mailto:EllePeng@aliyun.com" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
    <a href="https://weibo.com/3199262327/profile?topnav=1&amp;wvr=6" target="_blank"><i class="fa fa-weibo fa-fw"></i></a>
</div></div>
</div>
</div>

<div id="lx-main-content">
  <div class="lx-post">
    <div class="lx-entry padding">
      <div>
        <style  type="text/css">
.lx-entry a {
    color: #191919;
    padding: 2px 0 1px 0;
    text-decoration: none;
    background-image: linear-gradient( transparent 0%, transparent calc(50% - 9px), rgba(247,65,65,.761) calc(50% - 9px), rgba(247,65,65,.761) 100% );
    transition: background-position 120ms ease-in-out, padding 120ms ease-in-out;
    background-size: 100% 200%;
    background-position: 0 0;
    word-break: break-word;
}

.lx-entry a:hover {
  background-image: linear-gradient( transparent 0%, transparent calc(50% - 9px), rgba(247,65,65,.761) calc(50% - 9px), rgba(247,65,65,.761) 100% );
  background-position: 0 100%;
}

.post-button a:hover {
  background-image: linear-gradient( transparent 0%, transparent calc(50% - 9px), transparent calc(50% - 9px), transparent 100% ) !important;
  background-position: 0 100% !important;
  outline: none !important;
  text-decoration: none !important;
}
</style>

<h2 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h2><ul>
<li>äº”ä¸€å‡æœŸï¼Œæ¥å†™ä¸€å†™ Promise çš„é¢˜å§ï¼Œå˜¿å˜¿å˜¿ ğŸ˜ƒ</li>
<li>äº”ä¸€å€’è®¡æ—¶ 3 å¤©</li>
</ul>
<a id="more"></a>
<h2 id="å®è·µå‡†å¤‡"><a href="#å®è·µå‡†å¤‡" class="headerlink" title="å®è·µå‡†å¤‡"></a>å®è·µå‡†å¤‡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation&#x2F;Foundation.h&gt;</span><br><span class="line">#import &lt;JavaScriptCore&#x2F;JavaScriptCore.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argx, const char * argv[]) &#123;</span><br><span class="line">  @autoreleasepool &#123;</span><br><span class="line">    &#x2F;&#x2F; var context &#x3D; new JSContext</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; define a javascript context</span><br><span class="line">    JSContext* context &#x3D; [[JSContext alloc] init];</span><br><span class="line">    &#x2F;&#x2F; like:var result &#x3D; null;</span><br><span class="line">    JSValue* result;</span><br><span class="line">    </span><br><span class="line">    while(true) &#123;</span><br><span class="line">      char sourcecode[1024];</span><br><span class="line">      </span><br><span class="line">      scanf(&#39;%s&#39;, &amp;sourcecode);</span><br><span class="line">      NSString* code &#x3D; [NSString stringWithUTF8String: sourcecode];</span><br><span class="line">      </span><br><span class="line">      result &#x3D; [context evaluateScript:code];</span><br><span class="line">      </span><br><span class="line">      NSLog(@&quot;%@&quot;, [result toString]);</span><br><span class="line">      </span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  return 0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å¦‚ä¸Šå®ç°ä¸€ä¸ªç®€å•çš„äº‹ä»¶å¾ªç¯ï¼Œç”¨æ¥è¾“å‡º console</li>
<li><img src="http://p1.meituan.net/myvideodistribute/a99619da1cded49f443ded2fc219b27432778.png" alt="OC æ–¹æ³•"></li>
<li>æˆ‘ä»¬åœ¨ Javascript ä¸­è®²çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ã€å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ˜¯ Javascript è°ƒç”¨æ–¹å»ä½¿ç”¨ Javascript çš„ä¸€ç§æ–¹å¼ï¼Œå¦‚æœä»…æ˜¯æ‰§è¡Œä¸€æ®µä»£ç ï¼Œæ˜¯ä¸éœ€è¦äº‹ä»¶å¾ªç¯çš„ã€‚é€šè¿‡è¿™æ®µä»£ç ï¼Œæ˜¯å¯ä»¥çœ‹å‡ºæ¥ï¼ŒJavascript çš„äº‹ä»¶å¾ªç¯ï¼Œæ˜¯åœ¨ JSContext ä¹‹å¤–ï¼Œäº‹ä»¶å¾ªç¯ç›¸å…³çŸ¥è¯†ï¼Œæ—¢ä¸æ˜¯ Javascript å¼•æ“çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿä¸æ˜¯ Javascript è¯­è¨€çš„ä¸€éƒ¨åˆ†ã€‚</li>
<li>code çš„ä¼ å…¥æ–¹å¼<ul>
<li>&lt;script&gt;&lt;/script&gt; æ™®é€šä»£ç ç‰‡æ®µ</li>
<li>&lt;script type=â€moduleâ€&gt;&lt;/script&gt;</li>
<li>å‡½æ•°</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation&#x2F;Foundation.h&gt;</span><br><span class="line">#import &lt;JavaScriptCore&#x2F;JavaScriptCore.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argx, const char * argv[]) &#123;</span><br><span class="line">  @autoreleasepool &#123;</span><br><span class="line">    &#x2F;&#x2F; var context &#x3D; new JSContext</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; define a javascript context</span><br><span class="line">    JSContext* context &#x3D; [[JSContext alloc] init];</span><br><span class="line">    &#x2F;&#x2F; like:var result &#x3D; null;</span><br><span class="line">    JSValue* result;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; TODO: calculate the square of arg x</span><br><span class="line">    NSString* code &#x3D; @&quot;(function(x)&#123; return x * x; &#125;)&quot;;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; like: result &#x3D; (function(x)&#123; return x * x; &#125;)</span><br><span class="line">    result &#x3D; [context evaluateScript:code];</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; passing the number 4 into the function</span><br><span class="line">    JSValue* arg1 &#x3D; [JSValue valueWithInt32:4 inContext:context];</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; execute the function with arg of 4</span><br><span class="line">    NSLog(@&quot;%@&quot;, [[result callWithArguments:@[arg1]] toString]);</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  return 0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>ä¸Šé¢çš„ Object-C ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œæˆ‘ä»¬æ˜¯å°†ä¸€æ®µä¸€æ®µçš„ä»£ç ï¼Œä¼ å…¥ evaluateScript ä¸­æ‰§è¡Œã€‚</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Foundation&#x2F;Foundation.h&gt;</span><br><span class="line">#import &lt;JavaScriptCore&#x2F;JavaScriptCore.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argx, const char * argv[]) &#123;</span><br><span class="line">  @autoreleasepool &#123;</span><br><span class="line">    &#x2F;&#x2F; var context &#x3D; new JSContext</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; define a javascript context</span><br><span class="line">    JSContext* context &#x3D; [[JSContext alloc] init];</span><br><span class="line">    &#x2F;&#x2F; like:var result &#x3D; null;</span><br><span class="line">    JSValue* result;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; TODO: calculate the square of arg x</span><br><span class="line">    NSString* code &#x3D; @&quot;new Promise(resolve &#x3D;&gt; resolve()).then(() &#x3D;&gt; this.a &#x3D; 3), function()&#123;return this.a&#125;;&quot;;</span><br><span class="line">        </span><br><span class="line">    result &#x3D; [context evaluateScript:code];</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; like: result();</span><br><span class="line">    NSLog(@&quot;%@&quot;, [[result callWithArguments:@[]] toString]);</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  return 0;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><p>evaluateScript å®é™…ä¸Šæ‰§è¡Œä¸¤æ­¥ï¼š</p>
<ol>
<li><p>æ‰§è¡Œæ•´ä¸ªæ–¹æ³•</p>
<blockquote>
<p>new Promise(resolve =&gt; resolve()).then(() =&gt; this.a = 3), function(){return this.a};</p>
</blockquote>
<ul>
<li>é€—å·è¡¨è¾¾å¼ï¼Œæ°¸è¿œè¿”å›åé¢çš„å€¼ï¼Œå¦‚æœè¢«è°ƒç”¨ï¼Œå‰é¢çš„ä¼šè¢«æ‰§è¡Œ</li>
</ul>
</li>
<li>æ‰§è¡Œ Promise ä¸­ then åé¢çš„è¯­å¥</li>
</ol>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/81d945c99778450fd86a710f20355cbc269796.png" alt="evaluateScript"></li>
<li>æœ‰ then ,å¯èƒ½äº§ç”Ÿä¸€ä¸ªå®ä»»åŠ¡é‡Œé¢æœ‰å¤šä¸ªå¾®ä»»åŠ¡çš„æƒ…å†µï¼Œ ä¸€åˆ‡JS ä»£ç éƒ½æ˜¯å¾®ä»»åŠ¡ä¸­æ‰§è¡Œçš„</li>
<li>æ‹¿æµè§ˆå™¨ä¸¾ä¾‹ï¼šsetTimeoutã€setInterval è¿™ç§å…¶å®ä¸æ˜¯ JS è¯­æ³•æœ¬èº«çš„ APIï¼Œæ˜¯ JS çš„å®¿ä¸»æµè§ˆå™¨æä¾›çš„ APIï¼Œ æ‰€ä»¥æ˜¯å®ä»»åŠ¡ã€‚</li>
<li>è€Œ Promise æ˜¯ JS æœ¬èº«è‡ªå¸¦çš„ APIï¼Œè¿™ç§å°±æ˜¯å¾®ä»»åŠ¡ã€‚</li>
</ul>
</li>
<li>æ€»ç»“ï¼š<strong>å®¿ä¸»æä¾›çš„æ–¹æ³•æ˜¯å®ä»»åŠ¡ï¼ŒJS è‡ªå¸¦çš„æ˜¯å¾®ä»»åŠ¡</strong></li>
<li><strong>ä»»åŠ¡åˆ—è¡¨åˆ—é‡Œé¢æœ‰å¾ˆå¤šå®ä»»åŠ¡ï¼Œç„¶åæ¯ä¸ªå®ä»»åŠ¡é‡Œé¢æœ‰ä¸€ä¸ªå¾®ä»»åŠ¡åˆ—è¡¨ï¼Œæ¯ä¸ªå®ä»»åŠ¡æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ä¹‹å‰ä¼šæŠŠè‡ªå·±å†…éƒ¨çš„å¾®ä»»åŠ¡æ‰§è¡Œå®Œ</strong></li>
<li><strong>å®ä»»åŠ¡</strong>åŒ…æ‹¬ï¼šscript ã€setTimeoutã€setInterval ã€setImmediate ã€I/O ã€UI renderingã€‚</li>
<li><strong>å¾®ä»»åŠ¡</strong>åŒ…æ‹¬ï¼šMutationObserverã€Promise.then()æˆ–catch()ã€Promiseä¸ºåŸºç¡€å¼€å‘çš„å…¶å®ƒæŠ€æœ¯ï¼Œæ¯”å¦‚fetch APIã€V8çš„åƒåœ¾å›æ”¶è¿‡ç¨‹ã€Nodeç‹¬æœ‰çš„process.nextTickã€‚</li>
</ul>
<h1 id="Javascript-ç»“æ„åŒ–ç¨‹åºè®¾è®¡åŸºç¡€è®¾æ–½"><a href="#Javascript-ç»“æ„åŒ–ç¨‹åºè®¾è®¡åŸºç¡€è®¾æ–½" class="headerlink" title="Javascript ç»“æ„åŒ–ç¨‹åºè®¾è®¡åŸºç¡€è®¾æ–½"></a>Javascript ç»“æ„åŒ–ç¨‹åºè®¾è®¡åŸºç¡€è®¾æ–½</h1><ul>
<li></li>
</ul>
<h2 id="å®è·µè®°å½•"><a href="#å®è·µè®°å½•" class="headerlink" title="å®è·µè®°å½•"></a>å®è·µè®°å½•</h2><h3 id="åŸºç¡€é¢˜"><a href="#åŸºç¡€é¢˜" class="headerlink" title="åŸºç¡€é¢˜"></a>åŸºç¡€é¢˜</h3><p>1.1 é¢˜ç›®ä¸€</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'1'</span>, promise1);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æï¼š</p>
<ul>
<li><p>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆæ‰§è¡Œ new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­ console.log(â€˜promise1â€™)</p>
<blockquote>
<p>console.log(â€˜1â€™, promise1);</p>
</blockquote>
</li>
<li><p>å†æ‰§è¡ŒåŒæ­¥ä»£ç </p>
</li>
<li>æ‰§è¡Œå®Œåï¼Œ promise1 ä¸­å¹¶æ²¡æœ‰ resolved, rejectedï¼Œ ä¸€ç›´å¤„åœ¨ pending çš„çŠ¶æ€</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/f45e1dbe45d84e46ab2fd24703cad0c521137.png" alt="é¢˜ç›®ä¸€æ‰§è¡Œ"></li>
</ul>
</li>
</ul>
<p>1.2 é¢˜ç›®äºŒ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  resolve(<span class="string">'success'</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆæ‰§è¡Œ new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­<ul>
<li>console.log(1);</li>
<li>resolve(â€˜successâ€™) å°† promise ä¸­çš„çŠ¶æ€æ›´æ”¹ä¸º resolvedï¼Œå¹¶ä¿å­˜ä¸‹æ¥</li>
<li>console.log(2);</li>
</ul>
</li>
<li>promise.then å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å†æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„åŒæ­¥ä»£ç <ul>
<li>console.log(4);</li>
</ul>
</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸” promise ä¸ºresolvedï¼Œæ‰§è¡Œ promise.then<ul>
<li>console.log(3);</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/c31fd6e9ba9c9f9ac4062d6b395706f230745.png" alt="é¢˜ç›®äºŒæ‰§è¡Œ"></li>
</ul>
</li>
</ul>
<p>1.3 é¢˜ç›®ä¸‰</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆæ‰§è¡Œ new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­<ul>
<li>console.log(1);</li>
<li>console.log(2);</li>
<li>è¯¥ promise æ²¡æœ‰ resolved, rejected, ä¸€ç›´å¤„åœ¨ pending</li>
</ul>
</li>
<li>promise.then å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å†æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„åŒæ­¥ä»£ç <ul>
<li>console.log(4);</li>
</ul>
</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä½† promise ä¸ºpendingï¼Œä¸å¯èƒ½æ‰§è¡Œ promise.then ä¸­æ–¹æ³•</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/b6e827ca293c65c261a83a81f1f5411227105.png" alt="é¢˜ç›®ä¸‰æ‰§è¡Œ"></li>
</ul>
</li>
</ul>
<p>1.4 é¢˜ç›®å››</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise1'</span>)</span><br><span class="line">  resolve(<span class="string">'resolve1'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'1'</span>, promise1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'2'</span>, promise2);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆæ‰§è¡Œ new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­<ul>
<li>console.log(â€˜promise1â€™)</li>
<li>resolve(â€˜resolve1â€™) å°† promise ä¸­çš„çŠ¶æ€æ›´æ”¹ä¸º resolvedï¼Œå¹¶ä¿å­˜ä¸‹æ¥</li>
</ul>
</li>
<li>promise1.then å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>promise2 æ˜¯ä¸€ä¸ªæ–°çŠ¶æ€ä¸º pending çš„ Promise</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜1â€™, promise1);<ul>
<li>promise1 ä¸­çŠ¶æ€åœ¨ä¸Šé¢å·²ç»æ›´æ”¹ä¸º resolved</li>
</ul>
</li>
<li>console.log(â€˜2â€™, promise2);<ul>
<li>promise2 ä¸­çŠ¶æ€ä¸ºpending</li>
</ul>
</li>
</ul>
</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— promise1.then <ul>
<li>console.log(res) <ul>
<li>å…¶ä¸­ promise1.thenï¼Œ promise1 çš„çŠ¶æ€ä¸º resolved</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/f31e7f8db309521b5252143252eaed2551272.png" alt="é¢˜ç›®å››è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>1.5 é¢˜ç›®äº”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fn = <span class="function"><span class="params">()</span> =&gt;</span> <span class="function">(<span class="params"><span class="keyword">new</span> <span class="built_in">Promise</span>((resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  resolve(<span class="string">'success'</span>)</span><br><span class="line">&#125;))</span><br><span class="line">fn().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'start'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œconst fn = () =&gt; (Promise Object) è¿”å›ä¸€ä¸ª promise å¯¹è±¡</li>
<li>fn()ï¼Œæ‰§è¡Œ fn æ–¹æ³•<ul>
<li>console.log(1);</li>
<li>resolve(â€˜successâ€™) å°† promise ä¸­çš„çŠ¶æ€æ›´æ”¹ä¸º resolvedï¼Œå¹¶ä¿å­˜ä¸‹æ¥</li>
</ul>
</li>
<li>Function.then å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜startâ€™)</li>
</ul>
</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— Function.then<ul>
<li>console.log(res) å…¶ä¸­ promise çš„çŠ¶æ€ä¸º resolved</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p1.meituan.net/myvideodistribute/955895672615c24a4eb671617d8b739829033.png" alt="é¢˜ç›®äº”è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>1.6 é¢˜ç›®å…­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fn = <span class="function"><span class="params">()</span> =&gt;</span></span><br><span class="line">  <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    resolve(<span class="string">"success"</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"start"</span>);</span><br><span class="line">fn().then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œconst fn = () =&gt; (Promise Object) è¿”å›ä¸€ä¸ª promise å¯¹è±¡</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€œstartâ€);</li>
</ul>
</li>
<li>fn(), æ‰§è¡Œ fn æ–¹æ³•<ul>
<li>console.log(1);</li>
<li>resolve(â€œsuccessâ€); å°† promise ä¸­çš„çŠ¶æ€æ›´æ”¹ä¸º resolvedï¼Œå¹¶ä¿å­˜ä¸‹æ¥</li>
</ul>
</li>
<li>Function.then å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— Function.then<ul>
<li>console.log(res); å…¶ä¸­ promise çš„çŠ¶æ€ä¸º resolved</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/ccd1a9148be91f5aa24847a0d4e23dfb31837.png" alt="é¢˜ç›®å…­è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<h3 id="Promise-ç»“åˆ-setTimeout"><a href="#Promise-ç»“åˆ-setTimeout" class="headerlink" title="Promise ç»“åˆ setTimeout"></a>Promise ç»“åˆ setTimeout</h3><p>2.1 é¢˜ç›®ä¸€</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'start'</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'time'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'resolve'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'end'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆæ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜startâ€™)</li>
</ul>
</li>
<li>setTimeout â€¦ å…¥é˜Ÿå®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>Promise.resolve().then â€¦ å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜endâ€™)</li>
</ul>
</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— Promise.resolve().then<ul>
<li>console.log(â€˜resolveâ€™)</li>
</ul>
</li>
<li>ç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ setTimeout â€¦<ul>
<li>console.log(â€˜timeâ€™)</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/4a9c74ab2a26cc16e55ce53f6fb765d630133.png" alt="é¢˜ç›®ä¸€è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>2.2 é¢˜ç›®äºŒ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"timerStart"</span>);</span><br><span class="line">    resolve(<span class="string">"success"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"timerEnd"</span>);</span><br><span class="line">  &#125;, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise.then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">4</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»ä¸Šè‡³ä¸‹ï¼Œå…ˆæ‰§è¡Œ new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­<ul>
<li>console.log(1);</li>
<li>setTimeout â€¦ å…¥é˜Ÿå®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>console.log(2);</li>
</ul>
</li>
<li>promise.then â€¦ å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(4);</li>
</ul>
</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— å…¶ä¸­ promise ä¸­ï¼Œå¹¶æ²¡æœ‰ resolvedã€rejectedï¼Œä¸€ç›´åœ¨ pendingï¼Œä¸å¯èƒ½æ‰§è¡Œ promise.then ä¸­æ–¹æ³•</li>
<li>ç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ setTimeout â€¦</li>
<li>ç¬¬äºŒä¸ªå®ä»»åŠ¡ setTimeout ä»£ç ä»ä¸Šè‡³ä¸‹æ‰§è¡Œ</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€œtimerStartâ€);</li>
<li>resolve(â€œsuccessâ€); å°† promise ä¸­çš„çŠ¶æ€æ›´æ”¹ä¸º resolvedï¼Œå¹¶ä¿å­˜ä¸‹æ¥</li>
<li>console.log(â€œtimerEndâ€);</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/66ea5bbd68d0841ad58cac5ca771625347414.png" alt="é¢˜ç›®äºŒè¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>2.3 é¢˜ç›®ä¸‰</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'timer1'</span>);</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'timer3'</span>)</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'timer2'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'start'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»ä¸Šæ‰§è¡Œ</li>
<li>setTimeout â€¦ åŠ å…¥å®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>setTimeout â€¦ åŠ å…¥å®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜startâ€™)</li>
</ul>
</li>
<li>ç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ setTimeout â€¦</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç  <ul>
<li>console.log(â€˜timer1â€™);</li>
</ul>
</li>
<li>setTimeout â€¦ åŠ å…¥å®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>ç¬¬äºŒä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜timer2â€™)</li>
</ul>
</li>
<li>ç¬¬ä¸‰ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜timer3â€™)</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/b5ab6578c5ba7d8d727a3bf47ba8879033812.png" alt="é¢˜ç›®ä¸‰è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'timer1'</span>);</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'timer2'</span>)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'start'</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>setTimeout â€¦ åŠ å…¥å®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>setTimeout â€¦ åŠ å…¥å®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜startâ€™)</li>
</ul>
</li>
<li>ç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ setTimeout â€¦</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜timer1â€™);</li>
<li>Promise.resolve().then â€¦ å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ—<ul>
<li>console.log(â€˜promiseâ€™)</li>
</ul>
</li>
</ul>
</li>
<li>ç¬¬äºŒä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ setTimeout â€¦</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜timer2â€™)</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/f65f2aa65848d2e8aaf5c3918509c6e934427.png" alt="é¢˜ç›®ä¸‰è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>2.4 é¢˜ç›®å››</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise1'</span>);</span><br><span class="line">  <span class="keyword">const</span> timer2 = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'timer2'</span>)</span><br><span class="line">  &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> timer1 = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'timer1'</span>)</span><br><span class="line">  <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'promise2'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'start'</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>Promise.resolve().then â€¦ å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>setTimeout â€¦ å…¥é˜Ÿå®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç </li>
<li>console.log(â€˜startâ€™);</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç </li>
<li>console.log(â€˜promise1â€™);</li>
<li>setTimeout â€¦ å…¥é˜Ÿå®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>ç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡ setTimeout â€¦</li>
<li>console.log(â€˜timer2â€™)</li>
<li>ç¬¬äºŒä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç </li>
<li>console.log(â€˜timer1â€™)</li>
<li>Promise.resolve().then â€¦ å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>console.log(â€˜promise2â€™)</li>
<li>ç¬¬äºŒä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡</li>
<li>console.log(â€˜timer2â€™)</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p1.meituan.net/myvideodistribute/60a22379f31bb12de055ed83a31aca0b46969.png" alt="é¢˜ç›®å››è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>2.5 é¢˜ç›®äº” ** å­˜åœ¨å’Œä¹‹å‰ä¸€æ ·çš„ï¼Œpromise resolved åï¼ŒçŠ¶æ€ä¸ŠæŠ›è‡³ä¸Šä¸€ä¸ª å®ä»»åŠ¡é˜Ÿåˆ—çš„é—®é¢˜</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">'success'</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'error!!!'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'promise1'</span>, promise1)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'promise2'</span>, promise2)</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise1'</span>, promise1)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'promise2'</span>, promise2)</span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>å…ˆæ‰§è¡Œ new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°ä¸­</li>
<li>setTimout â€¦ å…¥é˜Ÿå®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>promise1.then â€¦ å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜promise1â€™, promise1)<ul>
<li>å…¶ä¸­ promise1 æ²¡æœ‰ resolvedã€rejected,ä¸€ç›´å¤„åœ¨ pending çŠ¶æ€</li>
<li>promise1 Promise {\<pending\>}</li>
</ul>
</li>
<li>console.log(â€˜promise2â€™, promise2)<ul>
<li>å…¶ä¸­ promise1 ä¸€ç›´å¤„åœ¨ pending çŠ¶æ€ï¼Œç›´æ¥å½±å“åˆ° promise2 ä¹Ÿä¸€ç›´å¤„åœ¨ pending çŠ¶æ€</li>
<li>promise2 Promise {\<pending\>}</li>
</ul>
</li>
</ul>
</li>
<li>setTimeout â€¦ å…¥é˜Ÿå®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— promise1.then â€¦<ul>
<li>ç”±äº promise1 ä»å¤„äº pending çŠ¶æ€ï¼Œä¸å¯èƒ½æ‰§è¡Œ promise1.then â€¦</li>
</ul>
</li>
<li>ç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡</li>
<li>resolve(â€˜successâ€™) å°† promise1 ä¸­çš„çŠ¶æ€æ›´æ”¹ä¸º resolvedï¼Œå¹¶ä¿å­˜ä¸‹æ¥</li>
<li>ç¬¬äºŒä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜promise1â€™, promise1)<ul>
<li>å…¶ä¸­ promise1 å¤„åœ¨ resolved çŠ¶æ€</li>
<li>promise1 Promise {\<resolved\>: â€œsuccessâ€}</li>
</ul>
</li>
<li>console.log(â€˜promise2â€™, promise2)<ul>
<li>promise2 Promise {\<rejected\>: Error: error!!! at \<anonymous\>:8:9}</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/3ad654d66c66c648a058adf29154d879107368.png" alt="é¢˜ç›®äº”è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>2.6 é¢˜ç›®å…­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">"success"</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"timer1"</span>);</span><br><span class="line">  &#125;, <span class="number">1000</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"promise1é‡Œçš„å†…å®¹"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> promise2 = promise1.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"error!!!"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"promise1"</span>, promise1);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"promise2"</span>, promise2);</span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"timer2"</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"promise1"</span>, promise1);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"promise2"</span>, promise2);</span><br><span class="line">&#125;, <span class="number">2000</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œï¼Œå…ˆæ‰§è¡Œ new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°</li>
<li>setTimeout å…¥é˜Ÿå®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€œpromise1é‡Œçš„å†…å®¹â€);</li>
</ul>
</li>
<li>promise1.then â€¦ å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€œpromise1â€, promise1);<ul>
<li>å…¶ä¸­ promise1 æ²¡æœ‰ resolvedã€rejected æ‰ï¼Œä¸€ç›´å¤„åœ¨ pending çŠ¶æ€<ul>
<li>promise1 Promise {\<pending\>}</li>
</ul>
</li>
</ul>
</li>
<li>console.log(â€œpromise2â€, promise2);<ul>
<li>primise1 çš„ pending çŠ¶æ€ï¼Œç›´æ¥å½±å“ promise2 ä¹Ÿå¤„åœ¨ pending çŠ¶æ€<ul>
<li>promise2 Promise {\<pending\>}</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>setTimeout â€¦ å…¥é˜Ÿå®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— promise1.then â€¦<ul>
<li>ç”±äº promise1 ä»å¤„äº pending çŠ¶æ€ï¼Œä¸å¯èƒ½æ‰§è¡Œ promise1.then â€¦</li>
</ul>
</li>
<li>ç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ªå®ä»»åŠ¡</li>
<li>resolve(â€œsuccessâ€); å°† promise1 ä¸­çš„çŠ¶æ€æ›´æ”¹ä¸º resolvedï¼Œå¹¶ä¿å­˜ä¸‹æ¥</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€œtimer1â€);</li>
</ul>
</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— promise1.then â€¦<ul>
<li>throw new Error(â€œerror!!!â€);</li>
</ul>
</li>
<li>ç¬¬äºŒä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œäº†ï¼Œå¼€å§‹æ‰§è¡Œä¸‹ä¸€ä¸ªå®ä»»åŠ¡<ul>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€œtimer2â€);</li>
<li>console.log(â€œpromise1â€, promise1);<ul>
<li>å…¶ä¸­ promise1 çš„çŠ¶æ€å·²ç» resloved</li>
<li>promise1 Promise {\<resolved\>: â€œsuccessâ€}</li>
</ul>
</li>
<li>console.log(â€œpromise2â€, promise2);<ul>
<li>promise2 Promise {\<rejected\>: Error: error!!! at \<anonymous\>:8:9}</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p1.meituan.net/myvideodistribute/88a197ec5863fcca93b072d3baecf6a0113849.png" alt="é¢˜ç›®å…­è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<h3 id="Promise-ä¸­çš„-thenã€catchã€finally"><a href="#Promise-ä¸­çš„-thenã€catchã€finally" class="headerlink" title="Promise ä¸­çš„ thenã€catchã€finally"></a>Promise ä¸­çš„ thenã€catchã€finally</h3><p>3.1 é¢˜ç›®ä¸€</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">"success1"</span>);</span><br><span class="line">  reject(<span class="string">"error"</span>);</span><br><span class="line">  resolve(<span class="string">"success2"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise</span><br><span class="line">.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"then: "</span>, res);</span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"catch: "</span>, err);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œï¼Œå…ˆæ‰§è¡Œ new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°<ul>
<li>resolve(â€œsuccess1â€); å°† promise ä¸­çš„çŠ¶æ€æ›´æ”¹ä¸º resolvedï¼Œå¹¶ä¿å­˜ä¸‹æ¥</li>
</ul>
</li>
<li>promise.then â€¦ å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— promise.then â€¦<ul>
<li>console then:  success1</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/448d9fb1db29ba7e76762f97a9508d1e35386.png" alt="é¢˜ç›®ä¸€è¿è¡Œç»“æœ"></li>
</ul>
</li>
<li>ç»“è®º<ul>
<li><strong>Promiseçš„çŠ¶æ€ä¸€ç»æ”¹å˜å°±ä¸èƒ½å†æ”¹å˜</strong></li>
<li><strong>æ„é€ å‡½æ•°ä¸­çš„ resolve æˆ– reject åªæœ‰ç¬¬ä¸€æ¬¡æ‰§è¡Œæœ‰æ•ˆï¼Œå¤šæ¬¡è°ƒç”¨æ²¡æœ‰ä»»ä½•ä½œç”¨</strong>ã€‚</li>
</ul>
</li>
</ul>
<p>3.2 é¢˜ç›®äºŒ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  reject(<span class="string">"error"</span>);</span><br><span class="line">  resolve(<span class="string">"success2"</span>);</span><br><span class="line">&#125;);</span><br><span class="line">promise</span><br><span class="line">.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"then1: "</span>, res);</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"then2: "</span>, res);</span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"catch: "</span>, err);</span><br><span class="line">  &#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"then3: "</span>, res);</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œï¼Œå…ˆæ‰§è¡Œ new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°<ul>
<li>reject(â€œerrorâ€); å°† promise ä¸­çš„çŠ¶æ€æ›´æ”¹ä¸º rejectedï¼Œå¹¶ä¿å­˜ä¸‹æ¥</li>
</ul>
</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— promise.then â€¦</li>
<li>ç”±äº promise çŠ¶æ€ä¸º rejectedï¼Œå› æ­¤è§¦å‘ catch ï¼Œä¸ç®¡ catch è¿æ¥åˆ°å“ªï¼Œéƒ½èƒ½æ•è·ä¸Šå±‚æœªæ•æ‰è¿‡çš„é”™è¯¯<ul>
<li>console.log(â€œcatch: â€œ, err);</li>
<li>return a new promise</li>
</ul>
</li>
<li>ç”±äº æ–°çš„ promise æ²¡æœ‰è¿”å›å€¼ï¼Œå› æ­¤è¿”å› undefined</li>
</ul>
</li>
<li><p>ç»“è®º</p>
<ul>
<li><strong>catchä¸ç®¡è¢«è¿æ¥åˆ°å“ªé‡Œï¼Œéƒ½èƒ½æ•è·ä¸Šå±‚æœªæ•æ‰è¿‡çš„é”™è¯¯</strong></li>
<li>è‡³äº then3 ä¹Ÿä¼šè¢«æ‰§è¡Œï¼Œé‚£æ˜¯å› ä¸º<strong>catch()ä¹Ÿä¼šè¿”å›ä¸€ä¸ª Promise </strong>ï¼Œä¸”ç”±äºè¿™ä¸ª Promise æ²¡æœ‰è¿”å›å€¼ï¼Œæ‰€ä»¥æ‰“å°å‡ºæ¥çš„æ˜¯ undefined ã€‚</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/8523408bd03cb268237e720380e1273d47036.png" alt="é¢˜ç›®äºŒè¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>3.3 é¢˜ç›®ä¸‰</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve(<span class="number">1</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>promise çŠ¶æ€ä¸º resolved, å› æ­¤è§¦å‘ then<ul>
<li>console.log(res); res â€”&gt; 1</li>
</ul>
</li>
<li>æ²¡æœ‰æŠ¥é”™ï¼Œç•¥è¿‡ catch</li>
<li>è¢« then æ•æ‰<ul>
<li>console.log(2); è¿”å›æ–°çš„ promiseï¼Œ promise è¿”å› resolve(2)</li>
</ul>
</li>
</ul>
</li>
<li><p>ç»“è®º</p>
<ul>
<li><strong>Promise å¯ä»¥é“¾å¼è°ƒç”¨</strong>ï¼Œä¸è¿‡ promise æ¯æ¬¡è°ƒç”¨ .then æˆ–è€… .catch éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ promiseï¼Œä»è€Œå®ç°äº†é“¾å¼è°ƒç”¨, å®ƒå¹¶ä¸åƒä¸€èˆ¬æˆ‘ä»¬ä»»åŠ¡çš„é“¾å¼è°ƒç”¨ä¸€æ · return thisã€‚</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/2ca378bb1952c6fbacc3028024b1b89027624.png" alt="é¢˜ç›®ä¸‰è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>3.4 é¢˜ç›®å››</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.reject(<span class="number">1</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>promise çŠ¶æ€ä¸º rejectedï¼Œå› æ­¤è§¦å‘ catch<ul>
<li>console.log(err); err â€”&gt; 1</li>
<li>return resolve(3)</li>
</ul>
</li>
<li>è¢« then æ•æ‰<ul>
<li>console.log(3) </li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/ed821dfd96ad96250140abdedf581fd930226.png" alt="é¢˜ç›®å››è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>3.5 é¢˜ç›®äº”</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'timer'</span>)</span><br><span class="line">    resolve(<span class="string">'success'</span>)</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> start = <span class="built_in">Date</span>.now();</span><br><span class="line">promise.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res, <span class="built_in">Date</span>.now() - start)</span><br><span class="line">&#125;)</span><br><span class="line">promise.then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res, <span class="built_in">Date</span>.now() - start)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œï¼Œå…ˆæ‰§è¡Œ new Promiseï¼Œæ‰§è¡Œè¯¥æ„é€ å‡½æ•°</li>
<li>setTimeout â€¦ å…¥é˜Ÿå®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>promise.then â€¦ å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>promise.then â€¦ å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­çš„æ‰€æœ‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæ¯•ï¼Œå¼€å§‹æ‰§è¡Œå½“å‰å®ä»»åŠ¡ä¸­çš„å¾®ä»»åŠ¡é˜Ÿåˆ— promise.then â€¦</li>
<li>å› ä¸º promise çŠ¶æ€å¹¶æ²¡æœ‰ resolvedã€rejectedï¼Œä¸€ç›´å¤„åœ¨ pendingï¼Œå¹¶ä¸èƒ½è°ƒç”¨ then æ–¹æ³•</li>
<li>åŒä¸Š</li>
<li>ç¬¬ä¸€ä¸ªå®ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ªå®ä»»åŠ¡ setTimeout â€¦</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>console.log(â€˜timerâ€™)</li>
<li>promise çŠ¶æ€æ›´æ”¹ä¸º resolvedï¼Œå¹¶ä¿å­˜ä¸‹æ¥<ul>
<li>çŠ¶æ€å¾€ä¸ŠæŠ›</li>
<li>console.log(res, Date.now() - start)</li>
<li>console.log(res, Date.now() - start))</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>ç»“è®º</p>
<ul>
<li><strong>Promise çš„ .then æˆ–è€… .catch å¯ä»¥è¢«è°ƒç”¨å¤šæ¬¡ï¼Œä½†è¿™é‡Œ Promise æ„é€ å‡½æ•°åªæ‰§è¡Œä¸€æ¬¡ã€‚æˆ–è€…è¯´ promise å†…éƒ¨çŠ¶æ€ä¸€ç»æ”¹å˜ï¼Œå¹¶ä¸”æœ‰äº†ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆåç»­æ¯æ¬¡è°ƒç”¨ .then æˆ–è€… .catch éƒ½ä¼šç›´æ¥æ‹¿åˆ°è¯¥å€¼ã€‚</strong></li>
</ul>
</li>
<li>è¿è¡Œç»“æœ<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/9ee74ca562f7c913d51c9fd5fe60680543896.png" alt="é¢˜ç›®äº”è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>3.6 é¢˜ç›®å…­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'error!!!'</span>)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"then: "</span>, res)</span><br><span class="line">&#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"catch: "</span>, err)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>promise çŠ¶æ€æ›´æ”¹ä¸º resolveï¼Œå¹¶æ— è¿”å›å€¼</li>
<li>æ‰§è¡Œ then<ul>
<li>throw new Error(â€˜error!!!â€™)</li>
<li>return Promise.reject(new Error(â€˜error!!!â€™))</li>
</ul>
</li>
<li>è¢« catch æ•æ‰<ul>
<li>console.log(â€œcatch: â€œ, err) err â€”&gt; error</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/a1cb4e4f5e5ec95e2215d5b7ecc6a32428525.png" alt="é¢˜ç›®å…­è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>3.7 é¢˜ç›®ä¸ƒ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> promise = <span class="built_in">Promise</span>.resolve().then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> promise;</span><br><span class="line">&#125;)</span><br><span class="line">promise.catch(<span class="built_in">console</span>.err)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>promise çŠ¶æ€æ”¹å˜ä¸º resolve ï¼Œå¹¶æ— è¿”å›å€¼</li>
<li>æ‰§è¡Œ then<ul>
<li>return Promise.resolve(promise)</li>
<li>Chaining cycle detected for promise</li>
</ul>
</li>
<li>æ‰§è¡ŒåŒæ­¥ä»£ç <ul>
<li>promise.catch promise cycle</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/70dbed986bad1d410ad7be3de8fe963d21008.png" alt="é¢˜ç›®ä¸ƒè¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>3.8 é¢˜ç›®å…«</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve(<span class="number">1</span>)</span><br><span class="line">  .then(<span class="number">2</span>)</span><br><span class="line">  .then(<span class="built_in">Promise</span>.resolve(<span class="number">3</span>))</span><br><span class="line">  .then(<span class="built_in">console</span>.log)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>promise çŠ¶æ€æ”¹å˜ä¸º resolveï¼Œ return Promise.resolve(1)</li>
<li>.then æˆ–è€… .catch çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼é€ä¼ </li>
<li>ç¬¬ä¸€ä¸ªthenå’Œç¬¬äºŒä¸ªthenä¸­ä¼ å…¥çš„éƒ½ä¸æ˜¯å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯æ•°å­—ç±»å‹ï¼Œä¸€ä¸ªæ˜¯å¯¹è±¡ç±»å‹ï¼Œå› æ­¤å‘ç”Ÿäº†é€ä¼ ï¼Œå°†resolve(1) çš„å€¼ç›´æ¥ä¼ åˆ°æœ€åä¸€ä¸ªthené‡Œ</li>
</ul>
</li>
<li><p>ç»“è®º</p>
<ul>
<li><strong>.then æˆ–è€… .catch çš„å‚æ•°æœŸæœ›æ˜¯å‡½æ•°ï¼Œä¼ å…¥éå‡½æ•°åˆ™ä¼šå‘ç”Ÿå€¼é€ä¼ </strong></li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p1.meituan.net/myvideodistribute/68c56ed26f2845300ecba0dc6dc7a3e914382.png" alt="é¢˜ç›®å…«è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>3.9 é¢˜ç›®ä¹</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.reject(<span class="string">'err!!!'</span>)</span><br><span class="line">  .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'success'</span>, res)</span><br><span class="line">  &#125;, (err) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'error'</span>, err)</span><br><span class="line">  &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'catch'</span>, err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li>æˆ‘ä»¬å¯ä»¥å…ˆæ¥çœ‹çœ‹ï¼Œå¦‚æœ catch ä½äº†é”™è¯¯ï¼Œerr ä¼šä¸€ç›´é“¾å¼ä¼ é€’ä¸‹å»è¢« catchå˜›</li>
<li><img src="http://p1.meituan.net/myvideodistribute/f9859062c1341e2e575f952e320aba4222620.png" alt="æ˜¯å¦ä¼šè¢«ä¸€ç›´catch"><ul>
<li>ä¸€æ—¦ catch ä½å½“å‰æŠ¥é”™ï¼Œå½“å‰æŠ¥é”™å¹¶ä¸ä¼šå†å¾€ä¸‹ä¼ é€’</li>
</ul>
</li>
<li><img src="http://p1.meituan.net/myvideodistribute/9846287852a98f322045973bf302c58f24992.png" alt="é€è¡Œè°ƒç”¨catchæ˜¯ä¼šä¸€ç›´ä¼ é€’ä¸‹å»çš„"><ul>
<li>é€è¡Œè°ƒç”¨ then æ˜¯ä¼šä¸€ç›´ä¼ é€’ä¸‹å»çš„</li>
</ul>
</li>
<li>é‚£æˆ‘è¿˜å¯ä»¥çœ‹çœ‹ï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œres ä¼šä¸€ç›´é“¾å¼ä¼ é€’ then æ‰§è¡Œå˜›</li>
<li><img src="http://p1.meituan.net/myvideodistribute/e2e72158c05ceee7da7528ff9a20348426425.png" alt="æ˜¯å¦ä¼šè¢«ä¸€ç›´then"><ul>
<li>å¯ä»¥çœ‹å‡º then æ˜¯ä¼šä¸€ç›´å¾€ä¸‹ä¼ é€’çš„</li>
</ul>
</li>
<li><p><img src="http://p0.meituan.net/myvideodistribute/abb8ccf3daffdd023ce079c86cafdfd626377.png" alt="é€è¡Œè°ƒç”¨then æ˜¯ä¼šä¸€ç›´ä¼ é€’ä¸‹å»çš„"></p>
<ul>
<li>é€è¡Œè°ƒç”¨ then æ˜¯ä¼šä¸€ç›´ä¼ é€’ä¸‹å»çš„</li>
</ul>
</li>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>promise çŠ¶æ€æ”¹å˜ä¸º rejectedï¼Œreturn â€˜err!!!â€™</li>
<li>æ‰§è¡Œ thenï¼Œthen ä¸­ç¬¬äºŒä¸ªå‡½æ•°ï¼Œç›¸å½“äº catch</li>
<li>å› æ­¤æ‰§è¡Œ</li>
<li>console.log(â€˜errorâ€™, err) err â€”&gt; err!!!</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/05e3b86caaf2b9cbf0c6326020e3385327546.png" alt="é¢˜ç›®ä¹è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve()</span><br><span class="line">  .then(<span class="function"><span class="keyword">function</span> <span class="title">success</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'error!!!'</span>)</span><br><span class="line">  &#125;, <span class="function"><span class="keyword">function</span> <span class="title">fail1</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'fail1'</span>, err)</span><br><span class="line">  &#125;).catch(<span class="function"><span class="keyword">function</span> <span class="title">fail2</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'fail2'</span>, err)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>promise çŠ¶æ€å˜ä¸º resolveï¼Œ</li>
<li>æ‰§è¡Œ then<ul>
<li>throw new Error(â€˜error!!!â€™)</li>
</ul>
</li>
<li>è¢« catch <ul>
<li>console.log(â€˜fail2â€™, err) err â€”&gt; error!!!</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/c8643d8fb0fd251145befd28d635ed7e33265.png" alt="è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>3.10 é¢˜ç›®å</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'1'</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(res)</span><br><span class="line">  &#125;)</span><br><span class="line">  .finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'finally'</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"><span class="built_in">Promise</span>.resolve(<span class="string">'2'</span>)</span><br><span class="line">  .finally(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'finally2'</span>)</span><br><span class="line">  	<span class="keyword">return</span> <span class="string">'æˆ‘æ˜¯finally2è¿”å›çš„å€¼'</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'finally2åé¢çš„thenå‡½æ•°'</span>, res)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>promise çŠ¶æ€å˜ä¸º resolveï¼Œreturn 1</li>
<li>æ‰§è¡Œ then<ul>
<li>console.log(res) res â€”&gt; return new Promiseï¼Œ resolve(1) åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
</ul>
</li>
<li>promise çŠ¶æ€å˜ä¸º resolve, return 2<ul>
<li>æ‰§è¡Œ finally<ul>
<li>console.log(â€˜finally2â€™)</li>
<li>return new Promiseï¼Œ resolve(â€˜æˆ‘æ˜¯finally2è¿”å›çš„å€¼â€™) åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—</li>
</ul>
</li>
</ul>
</li>
<li>å½“å‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæˆï¼Œå¼€å§‹è¿˜è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—<ul>
<li>console.log(â€˜finallyâ€™)</li>
<li>console.log(â€˜finally2åé¢çš„thenå‡½æ•°â€™, res) res â€”&gt; 2</li>
</ul>
</li>
</ul>
</li>
<li><p>ç»“è®º</p>
<ul>
<li>.finally()æ–¹æ³•ä¸ç®¡Promiseå¯¹è±¡æœ€åçš„çŠ¶æ€å¦‚ä½•éƒ½ä¼šæ‰§è¡Œ</li>
<li>.finally()æ–¹æ³•çš„å›è°ƒå‡½æ•°ä¸æ¥å—ä»»ä½•çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ åœ¨.finally()å‡½æ•°ä¸­æ˜¯æ²¡æ³•çŸ¥é“Promiseæœ€ç»ˆçš„çŠ¶æ€æ˜¯resolvedè¿˜æ˜¯rejectedçš„</li>
<li>å®ƒæœ€ç»ˆè¿”å›çš„é»˜è®¤ä¼šæ˜¯ä¸€ä¸ª<strong>ä¸Šä¸€æ¬¡çš„Promiseå¯¹è±¡å€¼</strong>ï¼Œä¸è¿‡å¦‚æœæŠ›å‡ºçš„æ˜¯ä¸€ä¸ªå¼‚å¸¸åˆ™è¿”å›å¼‚å¸¸çš„Promiseå¯¹è±¡ã€‚</li>
<li><strong>promise æ¯æ¬¡è°ƒç”¨ .then æˆ–è€… .catch éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ promiseï¼Œä»è€Œå®ç°äº†é“¾å¼è°ƒç”¨</strong> </li>
</ul>
</li>
</ul>
<ul>
<li>è¿è¡Œç»“æœ<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/99d8936b8c5029a6786b464868666f7d47917.png" alt="é¢˜ç›®åè¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<h3 id="Promise-ä¸­çš„-all-å’Œ-race"><a href="#Promise-ä¸­çš„-all-å’Œ-race" class="headerlink" title="Promise ä¸­çš„ all å’Œ race"></a>Promise ä¸­çš„ all å’Œ race</h3><ul>
<li>Promise.all(iterable) æ–¹æ³•è¿”å›ä¸€ä¸ª Promise å®ä¾‹ï¼Œæ­¤å®ä¾‹åœ¨ iterable å‚æ•°å†…æ‰€æœ‰çš„ promise éƒ½â€œå®Œæˆï¼ˆresolvedï¼‰â€æˆ–å‚æ•°ä¸­ä¸åŒ…å« promise æ—¶å›è°ƒå®Œæˆï¼ˆresolveï¼‰ï¼›å¦‚æœå‚æ•°ä¸­  promise æœ‰ä¸€ä¸ªå¤±è´¥ï¼ˆrejectedï¼‰ï¼Œæ­¤å®ä¾‹å›è°ƒå¤±è´¥ï¼ˆrejectï¼‰ï¼Œå¤±è´¥çš„åŸå› æ˜¯ç¬¬ä¸€ä¸ªå¤±è´¥ promise çš„ç»“æœã€‚</li>
<li>Promise.race(iterable) æ–¹æ³•è¿”å›ä¸€ä¸ª promiseï¼Œä¸€æ—¦è¿­ä»£å™¨ä¸­çš„æŸä¸ªpromiseè§£å†³æˆ–æ‹’ç»ï¼Œè¿”å›çš„ promiseå°±ä¼šè§£å†³æˆ–æ‹’ç»ã€‚</li>
</ul>
<p>4.1 é¢˜ç›®ä¸€</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runAsync</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> r(x, <span class="built_in">console</span>.log(x)), <span class="number">1000</span>))</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Promise</span>.all([runAsync(<span class="number">1</span>), runAsync(<span class="number">2</span>), runAsync(<span class="number">3</span>)])</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res))</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ†æ<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>Promise.all å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæˆï¼Œå¼€å§‹æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—<ul>
<li>é—´éš”ä¸€ç§’åï¼Œæ§åˆ¶å°ä¼šåŒæ—¶æ‰“å°å‡º1, 2, 3ï¼Œè¿˜æœ‰ä¸€ä¸ªæ•°ç»„[1, 2, 3]</li>
</ul>
</li>
</ul>
</li>
<li><p>ç»“è®º</p>
<ul>
<li><strong>æœ‰äº†allï¼Œå°±å¯ä»¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªå›è°ƒä¸­å¤„ç†æ‰€æœ‰çš„è¿”å›æ•°æ®</strong></li>
<li>.all()åé¢çš„.then()é‡Œçš„å›è°ƒå‡½æ•°æ¥æ”¶çš„å°±æ˜¯æ‰€æœ‰å¼‚æ­¥æ“ä½œçš„ç»“æœã€‚</li>
<li>è€Œä¸”è¿™ä¸ªç»“æœä¸­æ•°ç»„çš„é¡ºåºå’ŒPromise.all()æ¥æ”¶åˆ°çš„æ•°ç»„é¡ºåºä¸€è‡´</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/d3a6d5f4f158de806b690af124fcec9431029.png" alt="é¢˜ç›®ä¸€è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>4.2 é¢˜ç›®äºŒ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runAsync</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> r(x, <span class="built_in">console</span>.log(x)), <span class="number">1000</span>))</span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runReject</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> rej(<span class="string">`Error: <span class="subst">$&#123;x&#125;</span>`</span>, <span class="built_in">console</span>.log(x)), <span class="number">1000</span> * x))</span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Promise</span>.all([runAsync(<span class="number">1</span>), runReject(<span class="number">4</span>), runAsync(<span class="number">3</span>), runReject(<span class="number">2</span>)])</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res))</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>Promise.all å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰åŒæ­¥ä»£ç æ‰§è¡Œå®Œæˆï¼Œå¼€å§‹æ‰§è¡Œå¾®ä»»åŠ¡é˜Ÿåˆ—<ul>
<li>é—´éš”ä¸€ç§’åï¼Œæ§åˆ¶å°ä¼šåŒæ—¶æ‰“å°å‡º 1, 3</li>
</ul>
</li>
<li>ç”±äº runReject(4) æ¯” runReject(2) æ™šå…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œä¸” catch åªæ‰§è¡Œä¸€æ¬¡<ul>
<li>å†é—´éš”ä¸€ç§’å<ul>
<li>console.log(x) x â€”&gt; 2</li>
<li>console.log(â€˜Error: 2â€™)</li>
</ul>
</li>
<li>å†é—´éš”2ç§’å<ul>
<li>console.log(x) x â€”&gt; 4</li>
<li>ä¸ä¼šå†æ‰§è¡Œ catch</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p1.meituan.net/myvideodistribute/e0e25426dc0d49c3af9acee68744760d51135.png" alt="é¢˜ç›®äºŒè¿è¡Œç»“æœ"></li>
</ul>
</li>
<li><p>ç­‰åŒäº</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runAsync</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> r(x, <span class="built_in">console</span>.log(x)), <span class="number">1000</span>))</span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runReject</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> rej(<span class="string">`Error: <span class="subst">$&#123;x&#125;</span>`</span>, <span class="built_in">console</span>.log(x)), <span class="number">1000</span> * x))</span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Promise</span>.all([runAsync(<span class="number">1</span>), runReject(<span class="number">4</span>), runAsync(<span class="number">3</span>), runReject(<span class="number">2</span>)])</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res), </span><br><span class="line">  err =&gt; <span class="built_in">console</span>.log(err);</span><br></pre></td></tr></table></figure></li>
<li>ç»“è®º<ul>
<li>all å’Œ raceä¼ å…¥çš„æ•°ç»„ä¸­å¦‚æœæœ‰ä¼šæŠ›å‡ºå¼‚å¸¸çš„å¼‚æ­¥ä»»åŠ¡ï¼Œé‚£ä¹ˆåªæœ‰æœ€å…ˆæŠ›å‡ºçš„é”™è¯¯ä¼šè¢«æ•è·ï¼Œå¹¶ä¸”æ˜¯è¢« then çš„ç¬¬äºŒä¸ªå‚æ•°æˆ–è€…åé¢çš„ catch æ•è·ï¼›ä½†å¹¶ä¸ä¼šå½±å“æ•°ç»„ä¸­å…¶å®ƒçš„å¼‚æ­¥ä»»åŠ¡çš„æ‰§è¡Œã€‚</li>
</ul>
</li>
</ul>
<p>4.3 é¢˜ç›®ä¸‰</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runAsync</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span> setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> r(x, <span class="built_in">console</span>.log(x)), <span class="number">1000</span>))</span><br><span class="line">  <span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Promise</span>.race([runAsync(<span class="number">1</span>), runAsync(<span class="number">2</span>), runAsync(<span class="number">3</span>)])</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">'result: '</span>, res))</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>Promise.race å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå¼€å§‹æ‰§è¡Œå¾®ä»»åŠ¡</li>
<li>åœ¨é—´éš”æ—¶é—´éƒ½ä¸€æ ·çš„æƒ…å†µä¸‹ï¼ŒrunAsync1 æœ€å…ˆåŠ å…¥é˜Ÿåˆ—</li>
<li>å› æ­¤<ul>
<li>console.log(x) x â€”&gt; 1</li>
</ul>
</li>
<li>ç”±äº race çš„ç‰¹æ®Šæ€§ï¼Œåªæ•æ‰æœ€å…ˆæ‰§è¡Œå®Œæˆçš„é‚£ä¸ªç»“æœ<ul>
<li>console.log(â€˜result: â€˜, res) res â€”&gt; 1</li>
</ul>
</li>
<li>å†<ul>
<li>console.log(x) x â€”&gt; 2</li>
<li>console.log(x) x â€”&gt; 3</li>
</ul>
</li>
<li>æ²¡æœ‰æŠ¥é”™ï¼Œä¸ä¼šè¢« catch</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p0.meituan.net/myvideodistribute/2eda438cd745e39ba934af362a80521038770.png" alt="é¢˜ç›®ä¸‰è¿è¡Œç»“æœ"></li>
</ul>
</li>
</ul>
<p>4.4 é¢˜ç›®å››</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runAsync</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">r</span> =&gt;</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> r(x, <span class="built_in">console</span>.log(x)), <span class="number">1000</span>)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runReject</span>(<span class="params">x</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">res, rej</span>) =&gt;</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> rej(<span class="string">`Error: <span class="subst">$&#123;x&#125;</span>`</span>, <span class="built_in">console</span>.log(x)), <span class="number">1000</span> * x)</span><br><span class="line">  );</span><br><span class="line">  <span class="keyword">return</span> p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Promise</span>.race([runReject(<span class="number">0</span>), runAsync(<span class="number">1</span>), runAsync(<span class="number">2</span>), runAsync(<span class="number">3</span>)])</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"result: "</span>, res))</span><br><span class="line">  .catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err));</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åˆ†æ</p>
<ul>
<li>ä»£ç ä»ä¸Šè‡³ä¸‹å¼€å§‹æ‰§è¡Œ</li>
<li>Promise.race å…¥é˜Ÿå¾®ä»»åŠ¡é˜Ÿåˆ—</li>
<li>å½“å‰å®ä»»åŠ¡ä¸­åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œå¼€å§‹æ‰§è¡Œå¾®ä»»åŠ¡</li>
<li>runReject(0) æœ€å…ˆä¼ å…¥</li>
<li>å› æ­¤<ul>
<li>console.log(x) x â€”&gt; 0</li>
<li>console.log(err) err â€”&gt; Error: 0</li>
</ul>
</li>
<li>é—´éš”å°äº1ç§’å</li>
<li>runAsync(1), runAsync(2), runAsync(3)<ul>
<li>ä¾æ¬¡ä¸º</li>
<li>console.log(x) x â€”&gt; 1</li>
<li>console.log(x) x â€”&gt; 2</li>
<li>console.log(x) x â€”&gt; 3</li>
</ul>
</li>
</ul>
</li>
<li><p>è¿è¡Œç»“æœ</p>
<ul>
<li><img src="http://p1.meituan.net/myvideodistribute/89acbf32e7218b90c050526171bd1b3d53719.png" alt="é¢˜ç›®å››"></li>
</ul>
</li>
</ul>
<h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><ul>
<li><a href="https://juejin.im/post/5e58c618e51d4526ed66b5cf" target="_blank" rel="noopener">é¢˜ç›®æ¥æº</a></li>
</ul>
<h2 id="å†™åœ¨åé¢"><a href="#å†™åœ¨åé¢" class="headerlink" title="å†™åœ¨åé¢"></a>å†™åœ¨åé¢</h2><ul>
<li>ç¥å¤§å®¶å¤šå¤šå‘è´¢</li>
</ul>

      </div>
    </div>
  </div>
</div>
<div class="lx-navigation">
	<div class="lx-cover prev lx-cover-sm" style="background-image: url(//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/images/footer-l.jpeg)">
		<div class="overlay"></div>
		<a class="copy" href="/2020/05/02/Javascrtip-%E8%BF%90%E8%A1%8C%E6%9C%BA%E5%88%B6%EF%BC%88%E4%BA%8C%EF%BC%89/">
			<div class="display-t">
				<div class="display-tc">
					<div>
						<span>Next</span>
						<h3>Javascr...</h3>
					</div>
				</div>
			</div>
		</a>
	</div>
        <div class="lx-cover next lx-cover-sm" style="background-image: url(//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/images/footer-r.jpeg)">
		<div class="overlay"></div>
		<a class="copy" href="/2020/04/26/Javascript-Statement/">
			<div class="display-t">
				<div class="display-tc">
					<div>
						<span>Prev</span>
						<h3>Javascr...</h3>
					</div>
				</div>
			</div>
		</a>
	</div>
</div>

</div>

<footer>
  <div>
  Copyright &copy; 2019.<a href="/">Be kind.</a><br>EllePeng
  </div>
</footer>

</div>

<button class="hamburger hamburger--arrow-r" type="button">
    <div class="hamburger-box">
      <div class="hamburger-inner"></div>
    </div>
</button> 
<div class="menu visibility">
  <div class="menu-head">
    <span class="layer">
      <div class="col">
        <div class="row for-pic">
          <div class="profile-pic">
            <a href="/"><img src="/images/avatar.jpeg" alt="EllePeng"/></a>
          </div>
        </div>
        <div class="row for-name">
          <p>EllePeng</p>
          <span class="tagline">stay awesome.</span>
        </div>
      </div>
    </span>
  </div>
  <nav class="menu-container">
  <ul class="menu-items">
    <li><a href="/"><i class="fa fa-home fa-fw"></i>Home</a></li>
    <li><a href="/archives/"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-th-list fa-fw"></i>Categories</span>
        <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CSS/">CSS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/HTML/">HTML</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Javascript/">Javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/react/">react</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF%E6%A6%82%E5%BF%B5/">å‰ç«¯æ¦‚å¿µ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/">å¾®ä¿¡å°ç¨‹åº</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/">æ€§èƒ½ç›‘æ§</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8/">æµè§ˆå™¨</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AE%97%E6%B3%95/">ç®—æ³•</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9B%BE%E5%BD%A2%E5%AD%A6/">è®¡ç®—æœºå›¾å½¢å­¦</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">è®¡ç®—æœºç½‘ç»œ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%98%85%E8%AF%BB/">é˜…è¯»</a></li></ul>
    </li>
    
    <li class="has-sub"><span class="dropdown-heading">
      <i class="fa fa-link fa-fw"></i>Friends</span>
        <ul>
          <li> <a href="https://blog.csdn.net/Elle_Peng" target="_blank">csdn</a></li>
        </ul>
    </li>
  </ul>
  </nav>
</div>

<div class="gototop js-top">
  <a href="#" class="js-gotop"><i class="fa fa-arrow-up"></i></a>
</div>
<script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/jquery.easing.min.js"></script>
<script>
(function () {
	"use strict";
	var goToTop = function() {
		$(".js-gotop").on("click", function(event){
			event.preventDefault();
			$("html, body").animate({
				scrollTop: $("html").offset().top
			}, 500, "easeInOutExpo");
			return false;
		});
		$(window).scroll(function(){
			var $win = $(window);
			if ($win.scrollTop() > 200) {
				$(".js-top").addClass("active");
			} else {
				$(".js-top").removeClass("active");
			}
		});
	};
	$(function(){
		goToTop();
	});
}());
</script>
<script src="//cdn.jsdelivr.net/npm/theme-lx@0.3.9/source/js/local.search.js"></script>

</body>
</html>
