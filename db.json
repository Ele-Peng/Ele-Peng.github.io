{"meta":{"version":1,"warehouse":"3.0.2"},"models":{"Asset":[{"_id":"themes/landscape/source/fancybox/blank.gif","path":"fancybox/blank.gif","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_loading.gif","path":"fancybox/fancybox_loading.gif","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/style.styl","path":"css/style.styl","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_loading@2x.gif","path":"fancybox/fancybox_loading@2x.gif","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_overlay.png","path":"fancybox/fancybox_overlay.png","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_sprite.png","path":"fancybox/fancybox_sprite.png","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/fancybox_sprite@2x.png","path":"fancybox/fancybox_sprite@2x.png","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.css","path":"fancybox/jquery.fancybox.css","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.js","path":"fancybox/jquery.fancybox.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.pack.js","path":"fancybox/jquery.fancybox.pack.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/js/script.js","path":"js/script.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.eot","path":"css/fonts/fontawesome-webfont.eot","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/fancybox_buttons.png","path":"fancybox/helpers/fancybox_buttons.png","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/fonts/FontAwesome.otf","path":"css/fonts/FontAwesome.otf","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.woff","path":"css/fonts/fontawesome-webfont.woff","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.css","path":"fancybox/helpers/jquery.fancybox-buttons.css","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.js","path":"fancybox/helpers/jquery.fancybox-buttons.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-media.js","path":"fancybox/helpers/jquery.fancybox-media.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.js","path":"fancybox/helpers/jquery.fancybox-thumbs.js","modified":0,"renderable":1},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.css","path":"fancybox/helpers/jquery.fancybox-thumbs.css","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.ttf","path":"css/fonts/fontawesome-webfont.ttf","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.svg","path":"css/fonts/fontawesome-webfont.svg","modified":0,"renderable":1},{"_id":"themes/landscape/source/css/images/banner.jpg","path":"css/images/banner.jpg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/favicon.ico","path":"favicon.ico","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/css/base.styl","path":"css/base.styl","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/css/main.min.css","path":"css/main.min.css","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/css/main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/images/footer-l.jpeg","path":"images/footer-l.jpeg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/images/footer-r.jpeg","path":"images/footer-r.jpeg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/images/post_cover.jpeg","path":"images/post_cover.jpeg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/images/quote-l.svg","path":"images/quote-l.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/images/quote-r.svg","path":"images/quote-r.svg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/js/jquery.easing.min.js","path":"js/jquery.easing.min.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/js/jquery.jside.menu.js","path":"js/jquery.jside.menu.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/js/local.search.js","path":"js/local.search.js","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/images/cover.jpeg","path":"images/cover.jpeg","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/css/page_style/page_style.styl","path":"css/page_style/page_style.styl","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/css/menu/button.styl","path":"css/menu/button.styl","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/css/menu/menu.styl","path":"css/menu/menu.styl","modified":0,"renderable":1},{"_id":"themes/hexo-theme-lx/source/images/avatar.jpeg","path":"images/avatar.jpeg","modified":0,"renderable":1}],"Cache":[{"_id":"themes/landscape/Gruntfile.js","hash":"71adaeaac1f3cc56e36c49d549b8d8a72235c9b9","modified":1585988623725},{"_id":"themes/landscape/.gitignore","hash":"58d26d4b5f2f94c2d02a4e4a448088e4a2527c77","modified":1585988623725},{"_id":"themes/landscape/README.md","hash":"37fae88639ef60d63bd0de22314d7cc4c5d94b07","modified":1585988623726},{"_id":"themes/landscape/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1585988623726},{"_id":"themes/landscape/_config.yml","hash":"79ac6b9ed6a4de5a21ea53fc3f5a3de92e2475ff","modified":1585988623726},{"_id":"themes/landscape/package.json","hash":"544f21a0b2c7034998b36ae94dba6e3e0f39f228","modified":1585988623734},{"_id":"source/_posts/hello-world.md","hash":"7d98d6592de80fdcd2949bd7401cec12afd98cdf","modified":1585988477655},{"_id":"themes/landscape/languages/de.yml","hash":"3ebf0775abbee928c8d7bda943c191d166ded0d3","modified":1585988623726},{"_id":"themes/landscape/languages/es.yml","hash":"76edb1171b86532ef12cfd15f5f2c1ac3949f061","modified":1585988623727},{"_id":"themes/landscape/languages/default.yml","hash":"3083f319b352d21d80fc5e20113ddf27889c9d11","modified":1585988623726},{"_id":"themes/landscape/languages/fr.yml","hash":"415e1c580ced8e4ce20b3b0aeedc3610341c76fb","modified":1585988623727},{"_id":"themes/landscape/languages/ja.yml","hash":"a73e1b9c80fd6e930e2628b393bfe3fb716a21a9","modified":1585988623727},{"_id":"themes/landscape/languages/nl.yml","hash":"12ed59faba1fc4e8cdd1d42ab55ef518dde8039c","modified":1585988623727},{"_id":"themes/landscape/languages/ko.yml","hash":"881d6a0a101706e0452af81c580218e0bfddd9cf","modified":1585988623727},{"_id":"themes/landscape/languages/no.yml","hash":"965a171e70347215ec726952e63f5b47930931ef","modified":1585988623727},{"_id":"themes/landscape/languages/pt.yml","hash":"57d07b75d434fbfc33b0ddb543021cb5f53318a8","modified":1585988623727},{"_id":"themes/landscape/languages/zh-CN.yml","hash":"ca40697097ab0b3672a80b455d3f4081292d1eed","modified":1585988623728},{"_id":"themes/landscape/languages/ru.yml","hash":"4fda301bbd8b39f2c714e2c934eccc4b27c0a2b0","modified":1585988623727},{"_id":"themes/landscape/languages/zh-TW.yml","hash":"53ce3000c5f767759c7d2c4efcaa9049788599c3","modified":1585988623728},{"_id":"themes/landscape/layout/archive.ejs","hash":"2703b07cc8ac64ae46d1d263f4653013c7e1666b","modified":1585988623732},{"_id":"themes/landscape/layout/index.ejs","hash":"aa1b4456907bdb43e629be3931547e2d29ac58c8","modified":1585988623732},{"_id":"themes/landscape/layout/category.ejs","hash":"765426a9c8236828dc34759e604cc2c52292835a","modified":1585988623732},{"_id":"themes/landscape/layout/layout.ejs","hash":"f155824ca6130080bb057fa3e868a743c69c4cf5","modified":1585988623733},{"_id":"themes/landscape/layout/page.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1585988623733},{"_id":"themes/landscape/layout/post.ejs","hash":"7d80e4e36b14d30a7cd2ac1f61376d9ebf264e8b","modified":1585988623733},{"_id":"themes/landscape/layout/tag.ejs","hash":"eaa7b4ccb2ca7befb90142e4e68995fb1ea68b2e","modified":1585988623733},{"_id":"themes/landscape/scripts/fancybox.js","hash":"aa411cd072399df1ddc8e2181a3204678a5177d9","modified":1585988623734},{"_id":"themes/landscape/layout/_partial/after-footer.ejs","hash":"d0d753d39038284d52b10e5075979cc97db9cd20","modified":1585988623728},{"_id":"themes/landscape/layout/_partial/archive-post.ejs","hash":"c7a71425a946d05414c069ec91811b5c09a92c47","modified":1585988623728},{"_id":"themes/landscape/layout/_partial/archive.ejs","hash":"950ddd91db8718153b329b96dc14439ab8463ba5","modified":1585988623729},{"_id":"themes/landscape/layout/_partial/article.ejs","hash":"c4c835615d96a950d51fa2c3b5d64d0596534fed","modified":1585988623729},{"_id":"themes/landscape/layout/_partial/footer.ejs","hash":"93518893cf91287e797ebac543c560e2a63b8d0e","modified":1585988623729},{"_id":"themes/landscape/layout/_partial/gauges-analytics.ejs","hash":"aad6312ac197d6c5aaf2104ac863d7eba46b772a","modified":1585988623729},{"_id":"themes/landscape/layout/_partial/google-analytics.ejs","hash":"f921e7f9223d7c95165e0f835f353b2938e40c45","modified":1585988623729},{"_id":"themes/landscape/layout/_partial/head.ejs","hash":"5abf77aec957d9445fc71a8310252f0013c84578","modified":1585988623729},{"_id":"themes/landscape/layout/_partial/header.ejs","hash":"7e749050be126eadbc42decfbea75124ae430413","modified":1585988623730},{"_id":"themes/landscape/layout/_partial/mobile-nav.ejs","hash":"e952a532dfc583930a666b9d4479c32d4a84b44e","modified":1585988623730},{"_id":"themes/landscape/layout/_widget/archive.ejs","hash":"beb4a86fcc82a9bdda9289b59db5a1988918bec3","modified":1585988623731},{"_id":"themes/landscape/layout/_partial/sidebar.ejs","hash":"930da35cc2d447a92e5ee8f835735e6fd2232469","modified":1585988623731},{"_id":"themes/landscape/layout/_widget/category.ejs","hash":"dd1e5af3c6af3f5d6c85dfd5ca1766faed6a0b05","modified":1585988623731},{"_id":"themes/landscape/layout/_widget/recent_posts.ejs","hash":"0d4f064733f8b9e45c0ce131fe4a689d570c883a","modified":1585988623731},{"_id":"themes/landscape/layout/_widget/tagcloud.ejs","hash":"b4a2079101643f63993dcdb32925c9b071763b46","modified":1585988623732},{"_id":"themes/landscape/layout/_widget/tag.ejs","hash":"2de380865df9ab5f577f7d3bcadf44261eb5faae","modified":1585988623732},{"_id":"themes/landscape/source/css/_extend.styl","hash":"222fbe6d222531d61c1ef0f868c90f747b1c2ced","modified":1585988623734},{"_id":"themes/landscape/source/css/_variables.styl","hash":"628e307579ea46b5928424313993f17b8d729e92","modified":1585988623738},{"_id":"themes/landscape/source/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1585988623750},{"_id":"themes/landscape/source/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1585988623750},{"_id":"themes/landscape/source/css/style.styl","hash":"a70d9c44dac348d742702f6ba87e5bb3084d65db","modified":1585988623749},{"_id":"themes/landscape/source/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1585988623750},{"_id":"themes/landscape/source/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1585988623751},{"_id":"themes/landscape/source/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1585988623751},{"_id":"themes/landscape/source/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1585988623751},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1585988623753},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1585988623754},{"_id":"themes/landscape/source/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1585988623754},{"_id":"themes/landscape/source/js/script.js","hash":"2876e0b19ce557fca38d7c6f49ca55922ab666a1","modified":1585988623755},{"_id":"themes/landscape/layout/_partial/post/category.ejs","hash":"c6bcd0e04271ffca81da25bcff5adf3d46f02fc0","modified":1585988623730},{"_id":"themes/landscape/layout/_partial/post/date.ejs","hash":"6197802873157656e3077c5099a7dda3d3b01c29","modified":1585988623730},{"_id":"themes/landscape/layout/_partial/post/nav.ejs","hash":"16a904de7bceccbb36b4267565f2215704db2880","modified":1585988623731},{"_id":"themes/landscape/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1585988623730},{"_id":"themes/landscape/layout/_partial/post/tag.ejs","hash":"2fcb0bf9c8847a644167a27824c9bb19ac74dd14","modified":1585988623731},{"_id":"themes/landscape/layout/_partial/post/title.ejs","hash":"2f275739b6f1193c123646a5a31f37d48644c667","modified":1585988623731},{"_id":"themes/landscape/source/css/_partial/archive.styl","hash":"db15f5677dc68f1730e82190bab69c24611ca292","modified":1585988623735},{"_id":"themes/landscape/source/css/_partial/footer.styl","hash":"e35a060b8512031048919709a8e7b1ec0e40bc1b","modified":1585988623736},{"_id":"themes/landscape/source/css/_partial/article.styl","hash":"10685f8787a79f79c9a26c2f943253450c498e3e","modified":1585988623735},{"_id":"themes/landscape/source/css/_partial/header.styl","hash":"85ab11e082f4dd86dde72bed653d57ec5381f30c","modified":1585988623736},{"_id":"themes/landscape/source/css/_partial/comment.styl","hash":"79d280d8d203abb3bd933ca9b8e38c78ec684987","modified":1585988623735},{"_id":"themes/landscape/source/css/_partial/highlight.styl","hash":"bf4e7be1968dad495b04e83c95eac14c4d0ad7c0","modified":1585988623736},{"_id":"themes/landscape/source/css/_partial/mobile.styl","hash":"a399cf9e1e1cec3e4269066e2948d7ae5854d745","modified":1585988623736},{"_id":"themes/landscape/source/css/_partial/sidebar-bottom.styl","hash":"8fd4f30d319542babfd31f087ddbac550f000a8a","modified":1585988623737},{"_id":"themes/landscape/source/css/_partial/sidebar.styl","hash":"404ec059dc674a48b9ab89cd83f258dec4dcb24d","modified":1585988623737},{"_id":"themes/landscape/source/css/_partial/sidebar-aside.styl","hash":"890349df5145abf46ce7712010c89237900b3713","modified":1585988623737},{"_id":"themes/landscape/source/css/_util/grid.styl","hash":"0bf55ee5d09f193e249083602ac5fcdb1e571aed","modified":1585988623737},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1585988623740},{"_id":"themes/landscape/source/css/_util/mixin.styl","hash":"44f32767d9fd3c1c08a60d91f181ee53c8f0dbb3","modified":1585988623738},{"_id":"themes/landscape/source/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1585988623752},{"_id":"themes/landscape/source/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1585988623740},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1585988623745},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1585988623752},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1585988623752},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1585988623753},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1585988623753},{"_id":"themes/landscape/source/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1585988623753},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1585988623744},{"_id":"themes/landscape/source/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1585988623743},{"_id":"themes/landscape/source/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1585988623749},{"_id":"public/2020/04/04/hello-world/index.html","hash":"c866b18d63d89b157229afce28be282d412d9dc3","modified":1586058603419},{"_id":"public/archives/index.html","hash":"523b6ce5b53f35e694bff2b853a1b3726a17522f","modified":1586059519727},{"_id":"public/archives/2020/index.html","hash":"523b6ce5b53f35e694bff2b853a1b3726a17522f","modified":1586059519727},{"_id":"public/archives/2020/04/index.html","hash":"523b6ce5b53f35e694bff2b853a1b3726a17522f","modified":1586059519727},{"_id":"public/index.html","hash":"3370648a80b8c73455720a1c25c97dd6bc70c256","modified":1586059519727},{"_id":"public/fancybox/fancybox_loading.gif","hash":"1a755fb2599f3a313cc6cfdb14df043f8c14a99c","modified":1585994247541},{"_id":"public/fancybox/fancybox_loading@2x.gif","hash":"273b123496a42ba45c3416adb027cd99745058b0","modified":1585994247541},{"_id":"public/fancybox/blank.gif","hash":"2daeaa8b5f19f0bc209d976c02bd6acb51b00b0a","modified":1585994247541},{"_id":"public/fancybox/fancybox_overlay.png","hash":"b3a4ee645ba494f52840ef8412015ba0f465dbe0","modified":1585994247541},{"_id":"public/fancybox/fancybox_sprite.png","hash":"17df19f97628e77be09c352bf27425faea248251","modified":1585994247541},{"_id":"public/fancybox/fancybox_sprite@2x.png","hash":"30c58913f327e28f466a00f4c1ac8001b560aed8","modified":1585994247541},{"_id":"public/fancybox/helpers/fancybox_buttons.png","hash":"e385b139516c6813dcd64b8fc431c364ceafe5f3","modified":1585994247541},{"_id":"public/css/fonts/fontawesome-webfont.eot","hash":"7619748fe34c64fb157a57f6d4ef3678f63a8f5e","modified":1585994247541},{"_id":"public/css/fonts/fontawesome-webfont.woff","hash":"04c3bf56d87a0828935bd6b4aee859995f321693","modified":1585994247541},{"_id":"public/css/fonts/FontAwesome.otf","hash":"b5b4f9be85f91f10799e87a083da1d050f842734","modified":1585994247541},{"_id":"public/css/fonts/fontawesome-webfont.ttf","hash":"7f09c97f333917034ad08fa7295e916c9f72fd3f","modified":1585994247541},{"_id":"public/fancybox/jquery.fancybox.css","hash":"aaa582fb9eb4b7092dc69fcb2d5b1c20cca58ab6","modified":1585994247541},{"_id":"public/js/script.js","hash":"2876e0b19ce557fca38d7c6f49ca55922ab666a1","modified":1585994247541},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.css","hash":"1a9d8e5c22b371fcc69d4dbbb823d9c39f04c0c8","modified":1585994247541},{"_id":"public/fancybox/helpers/jquery.fancybox-media.js","hash":"294420f9ff20f4e3584d212b0c262a00a96ecdb3","modified":1585994247541},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.js","hash":"47da1ae5401c24b5c17cc18e2730780f5c1a7a0c","modified":1585994247541},{"_id":"public/fancybox/helpers/jquery.fancybox-thumbs.css","hash":"4ac329c16a5277592fc12a37cca3d72ca4ec292f","modified":1585994247541},{"_id":"public/fancybox/helpers/jquery.fancybox-buttons.js","hash":"dc3645529a4bf72983a39fa34c1eb9146e082019","modified":1585994247541},{"_id":"public/css/style.css","hash":"5f8dadd37d0052c557061018fe6f568f64fced9b","modified":1585994247541},{"_id":"public/fancybox/jquery.fancybox.pack.js","hash":"9e0d51ca1dbe66f6c0c7aefd552dc8122e694a6e","modified":1585994247541},{"_id":"public/css/fonts/fontawesome-webfont.svg","hash":"46fcc0194d75a0ddac0a038aee41b23456784814","modified":1585994247541},{"_id":"public/css/images/banner.jpg","hash":"f44aa591089fcb3ec79770a1e102fd3289a7c6a6","modified":1585994247541},{"_id":"public/fancybox/jquery.fancybox.js","hash":"d08b03a42d5c4ba456ef8ba33116fdbb7a9cabed","modified":1585994247541},{"_id":"themes/hexo-theme-lx/.editorconfig","hash":"f8102695960fe708149c2e21934969700bfb0031","modified":1586055390182},{"_id":"themes/hexo-theme-lx/.gitignore","hash":"05277dd213f5ca95847c7aef888ff8255a772418","modified":1586055390183},{"_id":"themes/hexo-theme-lx/CODE_OF_CONDUCT.md","hash":"4faa826cb7049aff196edbf38e0b29c3fec2cf17","modified":1586055390183},{"_id":"themes/hexo-theme-lx/CONTRIBUTING.md","hash":"c70e994eb59d431ccaaf8b114ad74c8962cc3f45","modified":1586055390183},{"_id":"themes/hexo-theme-lx/LICENSE","hash":"2e43fe50cb85afda5cbd30aa4c056125f0e11a53","modified":1586055390184},{"_id":"themes/hexo-theme-lx/README.md","hash":"a76abaee1334d041715f639f5459187a787593bb","modified":1586055390184},{"_id":"themes/hexo-theme-lx/_config.yml","hash":"bed3cb1ac4c045d8bd4a87693eff773a5e71b1e6","modified":1586058314370},{"_id":"themes/hexo-theme-lx/package.json","hash":"7c15e6d012eee8b69d625b26f61adfd018a15f7f","modified":1586055390190},{"_id":"themes/hexo-theme-lx/README/README.zh.md","hash":"c70fee0ba91e87f711ff410313bf8325b27e0bb6","modified":1586055390184},{"_id":"themes/hexo-theme-lx/languages/zh.yml","hash":"b9a174e46bd89df7d6bf3a7863c350a62dce8a81","modified":1586055390185},{"_id":"themes/hexo-theme-lx/languages/en.yml","hash":"ec59da08e7c8dc61872b7896f167e42491965b2e","modified":1586055390185},{"_id":"themes/hexo-theme-lx/layout/archive.ejs","hash":"539ad764457af4434a6764c2044c4bbb9c34759f","modified":1586055390185},{"_id":"themes/hexo-theme-lx/layout/index.ejs","hash":"6c73bb34c29861124a0464a9a8dea95adf4fc5b0","modified":1586055390185},{"_id":"themes/hexo-theme-lx/layout/layout.ejs","hash":"a8e012724633a45c7601c38866176e11f88b0db9","modified":1586055390186},{"_id":"themes/hexo-theme-lx/layout/page.ejs","hash":"c0895bd2b63c5bba7c54686d6b7eaec9fbc520a5","modified":1586055390186},{"_id":"themes/hexo-theme-lx/layout/post.ejs","hash":"9396418ae3822ee444f44c509ec27955842c9360","modified":1586055390189},{"_id":"themes/hexo-theme-lx/source/favicon.ico","hash":"96b9a549337c2bec483c2879eeafa4d1f8748fed","modified":1586055390194},{"_id":"themes/hexo-theme-lx/.github/ISSUE_TEMPLATE/--------feature-request.md","hash":"14c1b9b0234e1930cdcb5effade695dd8ed96378","modified":1586055390182},{"_id":"themes/hexo-theme-lx/.github/ISSUE_TEMPLATE/------bug-bug-report.md","hash":"31d326cf90434637cc1223d1272f3db6913c1bc0","modified":1586055390182},{"_id":"themes/hexo-theme-lx/.github/ISSUE_TEMPLATE/------help-wanted.md","hash":"5d71620c4feb15de44248dc1bbfef0bdb83ff080","modified":1586055390182},{"_id":"themes/hexo-theme-lx/.github/workflows/greetings.yml","hash":"461379d4ffd3f2d5785cc8b20ce7369bf97f6657","modified":1586055390183},{"_id":"themes/hexo-theme-lx/layout/partials/aside.ejs","hash":"e9ea462c34f4edba0c62c5478b4a96edb66769ef","modified":1586055390186},{"_id":"themes/hexo-theme-lx/layout/partials/font.ejs","hash":"2dc65c0b4f60ed8329a296c5172aee8d42025a1e","modified":1586055390186},{"_id":"themes/hexo-theme-lx/layout/partials/config.ejs","hash":"6809577629e67dc00a2b20c2326818fa7f2c29be","modified":1586055390186},{"_id":"themes/hexo-theme-lx/layout/partials/footer.ejs","hash":"3a4cad29572a89e7c7354fe676af3997cb759bd9","modified":1586055390187},{"_id":"themes/hexo-theme-lx/layout/partials/menu.ejs","hash":"7c3d71999f233f5fb7549a472c922c8257711d5f","modified":1586055390187},{"_id":"themes/hexo-theme-lx/layout/partials/pagination.ejs","hash":"82c25643c1e3b16f0472eebfe77f4a03ad0e8824","modified":1586055390187},{"_id":"themes/hexo-theme-lx/layout/partials/post-header.ejs","hash":"adc798cf72c82a069fb354f48f65bba5f1405b45","modified":1586055390188},{"_id":"themes/hexo-theme-lx/layout/partials/post-footer.ejs","hash":"a2dbce8103bdc694439e8709c7f636f68ccc3328","modified":1586055390187},{"_id":"themes/hexo-theme-lx/layout/partials/recent-posts.ejs","hash":"889018a6df0c62b61c1c03712a2d3eb39882559c","modified":1586055390188},{"_id":"themes/hexo-theme-lx/layout/partials/search.ejs","hash":"e68af7bfc83edcf8da639982e1766c53f129128f","modified":1586055390188},{"_id":"themes/hexo-theme-lx/layout/partials/sociallinks.ejs","hash":"4460e06f88084f545b4409685644c7f101d11ba5","modified":1586055390188},{"_id":"themes/hexo-theme-lx/layout/third-party/comment.ejs","hash":"f1d1c9425059e76c8481829797de44df637c0723","modified":1586055390190},{"_id":"themes/hexo-theme-lx/layout/third-party/mathjax.ejs","hash":"e857f83195594e6ffcacf08f07df0c229806113b","modified":1586055390190},{"_id":"themes/hexo-theme-lx/source/css/base.styl","hash":"f29e3f7ab355d599d186ffc4a457169df4af3ad5","modified":1586055390192},{"_id":"themes/hexo-theme-lx/source/css/main.min.css","hash":"f92bf3eef5351215ee8bced4a40d88dab68330bf","modified":1586055390193},{"_id":"themes/hexo-theme-lx/source/css/main.styl","hash":"270db895d246e6084cb7a1a2620ded803313624b","modified":1586055390193},{"_id":"themes/hexo-theme-lx/source/images/avatar.jpeg","hash":"b6aba9aa030f22221d4a357a46a6bc6ef0cce556","modified":1586058121609},{"_id":"themes/hexo-theme-lx/source/images/footer-l.jpeg","hash":"f036edc5f66ffbcc34c3d855414c6ca5ef30a04b","modified":1586055390198},{"_id":"themes/hexo-theme-lx/source/images/footer-r.jpeg","hash":"5c7677ac85cf8a683b91e97702b7096017006b4f","modified":1586055390198},{"_id":"themes/hexo-theme-lx/source/images/post_cover.jpeg","hash":"93f216636c87dbbe635d4bb6b944851d92d84723","modified":1586055390199},{"_id":"themes/hexo-theme-lx/source/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1586055390200},{"_id":"themes/hexo-theme-lx/source/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1586055390200},{"_id":"themes/hexo-theme-lx/source/js/jquery.easing.min.js","hash":"af83a43279779fbc716f40ba8c5280782027540a","modified":1586055390200},{"_id":"themes/hexo-theme-lx/source/js/jquery.jside.menu.js","hash":"d15b40199520d22771f9a211ac4282041df2ae5a","modified":1586055390200},{"_id":"themes/hexo-theme-lx/source/js/local.search.js","hash":"3dd788d1e64431feb8faca7a7f175d25ed31f25a","modified":1586055390201},{"_id":"themes/hexo-theme-lx/scripts/helpers/font.js","hash":"0e7adebaf7bb3ba516c8f82cf26100237584bf44","modified":1586055390191},{"_id":"themes/hexo-theme-lx/scripts/tags/button.js","hash":"dd5da28768a3ed3f2e3b308a9ff220403825579f","modified":1586055390191},{"_id":"themes/hexo-theme-lx/scripts/tags/center-quote.js","hash":"e5086a9b99ac1c8006f4fa7c5568b96cc1d47cf6","modified":1586055390191},{"_id":"themes/hexo-theme-lx/scripts/tags/label.js","hash":"7247ac0f614993d4d162b14b68e924fc969581f5","modified":1586055390191},{"_id":"themes/hexo-theme-lx/scripts/tags/note.js","hash":"19dc88f867d684101e851e25fe9da661c56acc66","modified":1586055390192},{"_id":"themes/hexo-theme-lx/scripts/tags/video.js","hash":"3a70f28b9769fd308c8df7d694fb7f896f12ae58","modified":1586055390192},{"_id":"themes/hexo-theme-lx/source/images/cover.jpeg","hash":"13c52245fa1cede0083970f0facefa98017d48bc","modified":1586057417206},{"_id":"themes/hexo-theme-lx/layout/third-party/analytics/baidu-analytics.ejs","hash":"30cf8cd193777b1e071313528e06b16eca508187","modified":1586055390189},{"_id":"themes/hexo-theme-lx/layout/third-party/analytics/google-analytics.ejs","hash":"09775c366a01c656b7185ef3da4bc7b33caa2241","modified":1586055390189},{"_id":"themes/hexo-theme-lx/layout/third-party/analytics/index.ejs","hash":"c98b574b2634de33694edb40b1f9120160b81acb","modified":1586055390189},{"_id":"themes/hexo-theme-lx/source/css/page_style/page_style.styl","hash":"d10cea4992ee10e2ab88a2ae0ebe08854f55d7c6","modified":1586055390194},{"_id":"themes/hexo-theme-lx/source/css/menu/button.styl","hash":"d440d99e13b0f58edcab27bfce4e027e0e54fd77","modified":1586055390193},{"_id":"themes/hexo-theme-lx/source/css/menu/menu.styl","hash":"ebe4d6bc7e0081ad4d7659427abb98a1344c1aae","modified":1586055390194},{"_id":"public/favicon.ico","hash":"96b9a549337c2bec483c2879eeafa4d1f8748fed","modified":1586056615280},{"_id":"public/images/avatar.jpeg","hash":"b6aba9aa030f22221d4a357a46a6bc6ef0cce556","modified":1586058178217},{"_id":"public/images/quote-l.svg","hash":"94e870b4c8c48da61d09522196d4dd40e277a98f","modified":1586056615280},{"_id":"public/images/footer-l.jpeg","hash":"f036edc5f66ffbcc34c3d855414c6ca5ef30a04b","modified":1586056615280},{"_id":"public/images/post_cover.jpeg","hash":"93f216636c87dbbe635d4bb6b944851d92d84723","modified":1586056615280},{"_id":"public/images/footer-r.jpeg","hash":"5c7677ac85cf8a683b91e97702b7096017006b4f","modified":1586056615280},{"_id":"public/images/quote-r.svg","hash":"e60ae504f9d99b712c793c3740c6b100d057d4ec","modified":1586056615280},{"_id":"public/images/cover.jpeg","hash":"13c52245fa1cede0083970f0facefa98017d48bc","modified":1586058178217},{"_id":"public/css/base.css","hash":"6d884ebc4f4c1a7c750e4b871ecfff6c28b47ed0","modified":1586056615280},{"_id":"public/js/jquery.easing.min.js","hash":"af83a43279779fbc716f40ba8c5280782027540a","modified":1586056615280},{"_id":"public/js/jquery.jside.menu.js","hash":"688b8b03f8590a05e35a1fbbc59f37bc36051aa1","modified":1586056615280},{"_id":"public/css/menu/button.css","hash":"ce03713a291978281b66ce9d5738c456020a8e61","modified":1586056615280},{"_id":"public/css/page_style/page_style.css","hash":"0488c30dc3e728ec5ec89bb49fe979bd84acc964","modified":1586056615280},{"_id":"public/css/menu/menu.css","hash":"70f8a5b346f4b106eebc1c5199bc4add479da3c5","modified":1586056615280},{"_id":"public/js/local.search.js","hash":"3dd788d1e64431feb8faca7a7f175d25ed31f25a","modified":1586056615280},{"_id":"public/css/main.css","hash":"0235a5e568abff3de00c0228a94f47fd4f754575","modified":1586056615280},{"_id":"public/css/main.min.css","hash":"f92bf3eef5351215ee8bced4a40d88dab68330bf","modified":1586056615280},{"_id":"themes/hexo-theme-lx/source/images/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1586057481258},{"_id":"themes/hexo-theme-lx/source/images/avatar.png","hash":"13c52245fa1cede0083970f0facefa98017d48bc","modified":1586057417206},{"_id":"public/images/avatar.png","hash":"13c52245fa1cede0083970f0facefa98017d48bc","modified":1586057641234},{"_id":"public/search.xml","hash":"43d913c001c4b9eff05d2b0944ee48005069253f","modified":1586059519727},{"_id":"source/_posts/Popover.md","hash":"f90f4cbf30b2c503f6af560f4a3dff753a1c669a","modified":1586058680614},{"_id":"public/tags/微信小程序/index.html","hash":"57a2bac9d495095f330917a134af3346af288bbf","modified":1586059519727},{"_id":"public/2020/04/05/Popover/index.html","hash":"edb6bbaff6abcf4acb73384f38129e0629c06922","modified":1586059519727},{"_id":"public/categories/微信小程序/index.html","hash":"2fed6c08d949b59e73a721b65cc4e1884dfd1e0b","modified":1586059519727},{"_id":"source/_posts/.DS_Store","hash":"df2fbeb1400acda0909a32c1cf6bf492f1121e07","modified":1586058964847},{"_id":"source/_posts/canvas原生组件最顶层.md","hash":"3049de148e5231287246a7ae6cd7ddd62aa2d16e","modified":1586059509735},{"_id":"public/2020/04/05/canvas原生组件最顶层/index.html","hash":"28b17bc7f7dd11cf1e97e38ee55aeb089add3253","modified":1586059519727}],"Category":[{"name":"微信小程序","_id":"ck8mieyr10000xbp37i8baz0y"}],"Data":[],"Page":[],"Post":[{"layout":"微信小程序-气泡框","title":"Popover","date":"2020-04-05T03:47:05.000Z","_content":"\n####  写在前面\n- 记录基于[微信小程序-气泡框](https://developers.weixin.qq.com/community/develop/doc/000e4e7103c3c090e517e0cdb5b806)实现中产生的问题及思考\n- - -\n#### 问题截图\n![popover问题截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzlkMGY1NmUxOTVkNzFjMjAyYzVkYzI0OGMxMzg0NmUxMTQ3MTQucG5n?x-oss-process=image/format,png)\n#### 问题描述\n- 模拟器显示正常，但在真机上点击后，气泡框的箭头并没有消失，且点击同一级别区域，能利用覆盖消除箭头。【是不是一个很可爱的bug？\n\n#### 问题解决过程记录\n- 定位问题发生的原因范围\n\t- 样式\n\t\t- 样式在判断显示条件(wx:if=\"{{visible}}\")生效后，仍然渲染\n\t\t- 否定原因\n\t\t\t- 查询代码发现，整个样式背景的设定是在::before伪元素选择器中\n\t\t\t- 且显示条件生效，在调试器中已没有该元素，但仍显示\n\t- 逻辑\n\t\t- 会不会是组件在渲染时，多渲染一份，我们使用判断条件进行开关时，只是对其中一个进行了操作\n\t\t- 怀疑依据\n\t\t\t- ![popover问题依据截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzk5ZjcwMDAwZmViM2IwYzc0MWJmNjFiYzE5YTUwMDIxMjYyMTI3LnBuZw?x-oss-process=image/format,png)\n\t\t\t- 上图可见：在popover组件下，有2个通过&lt;slot&gt;插入的相同内容\n\n- 开始解决问题\n\t- 查询官方关于[slot](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html)方面的介绍\n\t\t- ![官方slot基础例子](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JjMTE0ZmI0YTdhOWZkY2ZlYzU3ZDE5ZWQyYWY0YzI3MzE1NTU4LnBuZw?x-oss-process=image/format,png)\n\t- 基于官方基础代码，复现问题\n\t\t- 产生一个child-tag组件，并在其中编写\n\t\t\t```javascript\n\t\t\t// components/child-tag.js.js\n\t\t\tComponent({\n\t\t\t  options: {\n\t\t\t    multipleSlots: true // 在组件定义时的选项中启用多slot支持\n\t\t\t  },\n\t\t\t  /**\n\t\t\t   * 组件的属性列表\n\t\t\t   */\n\t\t\t  properties: {\n\t\t\t\n\t\t\t  },\n\t\t\t  relations: {\n\t\t\t    './component-tag-name': {\n\t\t\t      type: 'parent',\n\t\t\t    }\n\t\t\t  },\n\t\t\t\n\t\t\t  /**\n\t\t\t   * 组件的初始数据\n\t\t\t   */\n\t\t\t  data: {\n\t\t\t\n\t\t\t  },\n\t\t\t\n\t\t\t  /**\n\t\t\t   * 组件的方法列表\n\t\t\t   */\n\t\t\t  methods: {\n\t\t\t\n\t\t\t  }\n\t\t\t})\n\t\t\t```\n\t\t- 与component-tag-name绑定形成父子组件\n\t\t\t```javascript\n\t\t\t// components/component-tag-name.js\n\t\t\tComponent({\n\t\t\t  options: {\n\t\t\t    multipleSlots: true // 在组件定义时的选项中启用多slot支持\n\t\t\t  },\n\t\t\t  relations: {\n\t\t\t    './child-tag': {\n\t\t\t      type: 'child',\n\t\t\t    }\n\t\t\t  },\n\t\t\t  /**\n\t\t\t   * 组件的属性列表\n\t\t\t   */\n\t\t\t  properties: {\n\t\t\t  },\n\t\t\t\n\t\t\t  /**\n\t\t\t   * 组件的初始数据\n\t\t\t   */\n\t\t\t  data: {\n\t\t\t    visible: false\n\t\t\t  },\n\t\t\t\n\t\t\t  /**\n\t\t\t   * 组件的方法列表\n\t\t\t   */\n\t\t\t  methods: {\n\t\t\t  \n\t\t\t  }\n\t\t\t})\n\t\t\t```\n\t\t- 并将index.html中进行调用\n\t\t\t```html\n\t\t\t<!-- 引用组件的页面模版 -->\n\t\t\t<view>\n\t\t\t  <button type=\"primary\" bindtap=\"onTap\">222</button>\n\t\t\t\t<my-component id=\"component\">\n\t\t\t\t\t<view slot=\"content\">\n\t\t\t\t\t\t这里是插入到组件slot name=\"content\"中的内容\n\t\t\t\t\t\t<child-component>\n\t\t\t\t\t\t\t<view slot=\"child\">这里是插入到组件slot name=\"child\"中的内容</view>\n\t\t\t\t\t\t</child-component>\n\t\t\t\t\t</view>\n\t\t\t\t</my-component>\n\t\t\t</view>\n\t\t\t```\n\t\t- 但是其结构树仍然非常正常，并没有出现那个所谓的\"拷贝\"组件\n\t\t\t- ![改写v1.1后的结构树截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzcwNTRhNjJkYmM2MGEyNmU5ZGI1ODYzNzNjOGY2OTgyMzg3NTI0LnBuZw?x-oss-process=image/format,png)\n\t\t\t- 仔细复现了几次，发现：多出来的那个组件会有所延迟。抓住这个问题，想到我们在onReady中，注册了该组件，于是，继续模拟\n\t\t- 修改index.js代码，并在component-tag-name组件注册onTap方法，控制显隐\n\t\t\t```javascript\n\t\t\t  onReady() {\n\t\t\t    this.component = this.selectComponent('#component')\n\t\t\t  },\n\t\t\t  onTap() {\n\t\t\t    console.log('onTap')\n\t\t\t    wx.createSelectorQuery().select('#component').boundingClientRect(res => {\n\t\t\t        // 调用自定义组件 popover 中的 onDisplay 方法\n\t\t\t        this.component.onTap();\n\t\t\t    }).exec();\n\t\t\t  }\n\t\t\t\t```\n\t\t- 最终复现\n\t\t\t- ![官方模拟最终运行截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzhmZjQ3OTNhMjUwYTNjMzlhYjBlOGQxMGJhYTllZmI2NDc1NjIyLnBuZw?x-oss-process=image/format,png)\n\t- 得出问题来源：\n\t\t- 在组件中进行了一次setData\n\t- 思考背后问题\n\t\t- 在组件中setData为什么会”拷贝“一份相同的在页面级wxml中？\n\t\t- 猜想一：从[WXS响应事件](https://developers.weixin.qq.com/miniprogram/dev/framework/view/interactive-animation.html#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88)中，我隐隐得到了答案\n\t\t- ![wxs相应事件](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzZlYWJjYjdjOTliMzAxNWMwOGQwZmM2YWM3ZmMxMGMzNDU5NDAxLnBuZw?x-oss-process=image/format,png)\n\t\t- 我们在页面级通过selectComponent实例化组件，对选中的组件进行操作，官方可以通过拷贝一份相同的组件，使我们便捷的将事件的处理从2次的逻辑层和渲染层通信以及一次渲染，减少到直接对页面上元素进行操作，即一次逻辑层和渲染层通信以及一次渲染。\n\t\t- 猜想二：问题层面是在微信开发者工具中的wxml，渲染方式对于这种情况就是这样处理的。\n- 官方已给出问题原因\n\t- ![wxml面板](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzJkMWVkZmYyNWIwM2YxZDU2ZGVjYjZhM2NkYjAwMGU5NTE5ODQucG5n?x-oss-process=image/format,png)\n\n#### 如何解决问题\n- 在popover以及popover-item加入\n\t```javascript\n\toptions: {\n\t\t\t    multipleSlots: true // 在组件定义时的选项中启用多slot支持\n\t\t\t  },\n\t```\n- 就可以解决了。最后建议slot中可以写上name这样代码可能会更易读。\n####  写在后面\n- 祝大家多多发财\n---","source":"_posts/Popover.md","raw":"---\nlayout: 微信小程序-气泡框\ntitle: Popover\ndate: 2020-04-05 11:47:05\ntags: \n- 微信小程序\ncategories:\n- 微信小程序\n\n\n---\n\n####  写在前面\n- 记录基于[微信小程序-气泡框](https://developers.weixin.qq.com/community/develop/doc/000e4e7103c3c090e517e0cdb5b806)实现中产生的问题及思考\n- - -\n#### 问题截图\n![popover问题截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzlkMGY1NmUxOTVkNzFjMjAyYzVkYzI0OGMxMzg0NmUxMTQ3MTQucG5n?x-oss-process=image/format,png)\n#### 问题描述\n- 模拟器显示正常，但在真机上点击后，气泡框的箭头并没有消失，且点击同一级别区域，能利用覆盖消除箭头。【是不是一个很可爱的bug？\n\n#### 问题解决过程记录\n- 定位问题发生的原因范围\n\t- 样式\n\t\t- 样式在判断显示条件(wx:if=\"{{visible}}\")生效后，仍然渲染\n\t\t- 否定原因\n\t\t\t- 查询代码发现，整个样式背景的设定是在::before伪元素选择器中\n\t\t\t- 且显示条件生效，在调试器中已没有该元素，但仍显示\n\t- 逻辑\n\t\t- 会不会是组件在渲染时，多渲染一份，我们使用判断条件进行开关时，只是对其中一个进行了操作\n\t\t- 怀疑依据\n\t\t\t- ![popover问题依据截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzk5ZjcwMDAwZmViM2IwYzc0MWJmNjFiYzE5YTUwMDIxMjYyMTI3LnBuZw?x-oss-process=image/format,png)\n\t\t\t- 上图可见：在popover组件下，有2个通过&lt;slot&gt;插入的相同内容\n\n- 开始解决问题\n\t- 查询官方关于[slot](https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html)方面的介绍\n\t\t- ![官方slot基础例子](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JjMTE0ZmI0YTdhOWZkY2ZlYzU3ZDE5ZWQyYWY0YzI3MzE1NTU4LnBuZw?x-oss-process=image/format,png)\n\t- 基于官方基础代码，复现问题\n\t\t- 产生一个child-tag组件，并在其中编写\n\t\t\t```javascript\n\t\t\t// components/child-tag.js.js\n\t\t\tComponent({\n\t\t\t  options: {\n\t\t\t    multipleSlots: true // 在组件定义时的选项中启用多slot支持\n\t\t\t  },\n\t\t\t  /**\n\t\t\t   * 组件的属性列表\n\t\t\t   */\n\t\t\t  properties: {\n\t\t\t\n\t\t\t  },\n\t\t\t  relations: {\n\t\t\t    './component-tag-name': {\n\t\t\t      type: 'parent',\n\t\t\t    }\n\t\t\t  },\n\t\t\t\n\t\t\t  /**\n\t\t\t   * 组件的初始数据\n\t\t\t   */\n\t\t\t  data: {\n\t\t\t\n\t\t\t  },\n\t\t\t\n\t\t\t  /**\n\t\t\t   * 组件的方法列表\n\t\t\t   */\n\t\t\t  methods: {\n\t\t\t\n\t\t\t  }\n\t\t\t})\n\t\t\t```\n\t\t- 与component-tag-name绑定形成父子组件\n\t\t\t```javascript\n\t\t\t// components/component-tag-name.js\n\t\t\tComponent({\n\t\t\t  options: {\n\t\t\t    multipleSlots: true // 在组件定义时的选项中启用多slot支持\n\t\t\t  },\n\t\t\t  relations: {\n\t\t\t    './child-tag': {\n\t\t\t      type: 'child',\n\t\t\t    }\n\t\t\t  },\n\t\t\t  /**\n\t\t\t   * 组件的属性列表\n\t\t\t   */\n\t\t\t  properties: {\n\t\t\t  },\n\t\t\t\n\t\t\t  /**\n\t\t\t   * 组件的初始数据\n\t\t\t   */\n\t\t\t  data: {\n\t\t\t    visible: false\n\t\t\t  },\n\t\t\t\n\t\t\t  /**\n\t\t\t   * 组件的方法列表\n\t\t\t   */\n\t\t\t  methods: {\n\t\t\t  \n\t\t\t  }\n\t\t\t})\n\t\t\t```\n\t\t- 并将index.html中进行调用\n\t\t\t```html\n\t\t\t<!-- 引用组件的页面模版 -->\n\t\t\t<view>\n\t\t\t  <button type=\"primary\" bindtap=\"onTap\">222</button>\n\t\t\t\t<my-component id=\"component\">\n\t\t\t\t\t<view slot=\"content\">\n\t\t\t\t\t\t这里是插入到组件slot name=\"content\"中的内容\n\t\t\t\t\t\t<child-component>\n\t\t\t\t\t\t\t<view slot=\"child\">这里是插入到组件slot name=\"child\"中的内容</view>\n\t\t\t\t\t\t</child-component>\n\t\t\t\t\t</view>\n\t\t\t\t</my-component>\n\t\t\t</view>\n\t\t\t```\n\t\t- 但是其结构树仍然非常正常，并没有出现那个所谓的\"拷贝\"组件\n\t\t\t- ![改写v1.1后的结构树截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzcwNTRhNjJkYmM2MGEyNmU5ZGI1ODYzNzNjOGY2OTgyMzg3NTI0LnBuZw?x-oss-process=image/format,png)\n\t\t\t- 仔细复现了几次，发现：多出来的那个组件会有所延迟。抓住这个问题，想到我们在onReady中，注册了该组件，于是，继续模拟\n\t\t- 修改index.js代码，并在component-tag-name组件注册onTap方法，控制显隐\n\t\t\t```javascript\n\t\t\t  onReady() {\n\t\t\t    this.component = this.selectComponent('#component')\n\t\t\t  },\n\t\t\t  onTap() {\n\t\t\t    console.log('onTap')\n\t\t\t    wx.createSelectorQuery().select('#component').boundingClientRect(res => {\n\t\t\t        // 调用自定义组件 popover 中的 onDisplay 方法\n\t\t\t        this.component.onTap();\n\t\t\t    }).exec();\n\t\t\t  }\n\t\t\t\t```\n\t\t- 最终复现\n\t\t\t- ![官方模拟最终运行截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzhmZjQ3OTNhMjUwYTNjMzlhYjBlOGQxMGJhYTllZmI2NDc1NjIyLnBuZw?x-oss-process=image/format,png)\n\t- 得出问题来源：\n\t\t- 在组件中进行了一次setData\n\t- 思考背后问题\n\t\t- 在组件中setData为什么会”拷贝“一份相同的在页面级wxml中？\n\t\t- 猜想一：从[WXS响应事件](https://developers.weixin.qq.com/miniprogram/dev/framework/view/interactive-animation.html#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88)中，我隐隐得到了答案\n\t\t- ![wxs相应事件](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzZlYWJjYjdjOTliMzAxNWMwOGQwZmM2YWM3ZmMxMGMzNDU5NDAxLnBuZw?x-oss-process=image/format,png)\n\t\t- 我们在页面级通过selectComponent实例化组件，对选中的组件进行操作，官方可以通过拷贝一份相同的组件，使我们便捷的将事件的处理从2次的逻辑层和渲染层通信以及一次渲染，减少到直接对页面上元素进行操作，即一次逻辑层和渲染层通信以及一次渲染。\n\t\t- 猜想二：问题层面是在微信开发者工具中的wxml，渲染方式对于这种情况就是这样处理的。\n- 官方已给出问题原因\n\t- ![wxml面板](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzJkMWVkZmYyNWIwM2YxZDU2ZGVjYjZhM2NkYjAwMGU5NTE5ODQucG5n?x-oss-process=image/format,png)\n\n#### 如何解决问题\n- 在popover以及popover-item加入\n\t```javascript\n\toptions: {\n\t\t\t    multipleSlots: true // 在组件定义时的选项中启用多slot支持\n\t\t\t  },\n\t```\n- 就可以解决了。最后建议slot中可以写上name这样代码可能会更易读。\n####  写在后面\n- 祝大家多多发财\n---","slug":"Popover","published":1,"updated":"2020-04-05T03:51:20.614Z","_id":"ck8micb6p0000vnp33y4s5kfe","comments":1,"photos":[],"link":"","content":"<h4 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h4><ul>\n<li>记录基于<a href=\"https://developers.weixin.qq.com/community/develop/doc/000e4e7103c3c090e517e0cdb5b806\" target=\"_blank\" rel=\"noopener\">微信小程序-气泡框</a>实现中产生的问题及思考</li>\n</ul>\n<hr>\n<h4 id=\"问题截图\"><a href=\"#问题截图\" class=\"headerlink\" title=\"问题截图\"></a>问题截图</h4><p><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzlkMGY1NmUxOTVkNzFjMjAyYzVkYzI0OGMxMzg0NmUxMTQ3MTQucG5n?x-oss-process=image/format,png\" alt=\"popover问题截图\"></p>\n<h4 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h4><ul>\n<li>模拟器显示正常，但在真机上点击后，气泡框的箭头并没有消失，且点击同一级别区域，能利用覆盖消除箭头。【是不是一个很可爱的bug？</li>\n</ul>\n<h4 id=\"问题解决过程记录\"><a href=\"#问题解决过程记录\" class=\"headerlink\" title=\"问题解决过程记录\"></a>问题解决过程记录</h4><ul>\n<li><p>定位问题发生的原因范围</p>\n<ul>\n<li>样式<ul>\n<li>样式在判断显示条件(wx:if=”“)生效后，仍然渲染</li>\n<li>否定原因<ul>\n<li>查询代码发现，整个样式背景的设定是在::before伪元素选择器中</li>\n<li>且显示条件生效，在调试器中已没有该元素，但仍显示</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>逻辑<ul>\n<li>会不会是组件在渲染时，多渲染一份，我们使用判断条件进行开关时，只是对其中一个进行了操作</li>\n<li>怀疑依据<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzk5ZjcwMDAwZmViM2IwYzc0MWJmNjFiYzE5YTUwMDIxMjYyMTI3LnBuZw?x-oss-process=image/format,png\" alt=\"popover问题依据截图\"></li>\n<li>上图可见：在popover组件下，有2个通过&lt;slot&gt;插入的相同内容</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>开始解决问题</p>\n<ul>\n<li>查询官方关于<a href=\"https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html\" target=\"_blank\" rel=\"noopener\">slot</a>方面的介绍<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JjMTE0ZmI0YTdhOWZkY2ZlYzU3ZDE5ZWQyYWY0YzI3MzE1NTU4LnBuZw?x-oss-process=image/format,png\" alt=\"官方slot基础例子\"></li>\n</ul>\n</li>\n<li>基于官方基础代码，复现问题<ul>\n<li>产生一个child-tag组件，并在其中编写  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// components/child-tag.js.js</span></span><br><span class=\"line\">Component(&#123;</span><br><span class=\"line\">  options: &#123;</span><br><span class=\"line\">    multipleSlots: <span class=\"literal\">true</span> <span class=\"comment\">// 在组件定义时的选项中启用多slot支持</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的属性列表</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  properties: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  relations: &#123;</span><br><span class=\"line\">    <span class=\"string\">'./component-tag-name'</span>: &#123;</span><br><span class=\"line\">      type: <span class=\"string\">'parent'</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的初始数据</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的方法列表</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n<li>与component-tag-name绑定形成父子组件  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// components/component-tag-name.js</span></span><br><span class=\"line\">Component(&#123;</span><br><span class=\"line\">  options: &#123;</span><br><span class=\"line\">    multipleSlots: <span class=\"literal\">true</span> <span class=\"comment\">// 在组件定义时的选项中启用多slot支持</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  relations: &#123;</span><br><span class=\"line\">    <span class=\"string\">'./child-tag'</span>: &#123;</span><br><span class=\"line\">      type: <span class=\"string\">'child'</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的属性列表</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  properties: &#123;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的初始数据</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    visible: <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的方法列表</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n<li>并将index.html中进行调用  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 引用组件的页面模版 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"primary\"</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">\"onTap\"</span>&gt;</span>222<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">my-component</span> <span class=\"attr\">id</span>=<span class=\"string\">\"component\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">slot</span>=<span class=\"string\">\"content\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t这里是插入到组件slot name=\"content\"中的内容</span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">child-component</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">slot</span>=<span class=\"string\">\"child\"</span>&gt;</span>这里是插入到组件slot name=\"child\"中的内容<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">child-component</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">my-component</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li>\n<li>但是其结构树仍然非常正常，并没有出现那个所谓的”拷贝”组件<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzcwNTRhNjJkYmM2MGEyNmU5ZGI1ODYzNzNjOGY2OTgyMzg3NTI0LnBuZw?x-oss-process=image/format,png\" alt=\"改写v1.1后的结构树截图\"></li>\n<li>仔细复现了几次，发现：多出来的那个组件会有所延迟。抓住这个问题，想到我们在onReady中，注册了该组件，于是，继续模拟</li>\n</ul>\n</li>\n<li>修改index.js代码，并在component-tag-name组件注册onTap方法，控制显隐  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onReady() &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.component = <span class=\"keyword\">this</span>.selectComponent(<span class=\"string\">'#component'</span>)</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">onTap() &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'onTap'</span>)</span><br><span class=\"line\">  wx.createSelectorQuery().select(<span class=\"string\">'#component'</span>).boundingClientRect(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 调用自定义组件 popover 中的 onDisplay 方法</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.component.onTap();</span><br><span class=\"line\">  &#125;).exec();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>最终复现<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzhmZjQ3OTNhMjUwYTNjMzlhYjBlOGQxMGJhYTllZmI2NDc1NjIyLnBuZw?x-oss-process=image/format,png\" alt=\"官方模拟最终运行截图\"></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>得出问题来源：<ul>\n<li>在组件中进行了一次setData</li>\n</ul>\n</li>\n<li>思考背后问题<ul>\n<li>在组件中setData为什么会”拷贝“一份相同的在页面级wxml中？</li>\n<li>猜想一：从<a href=\"https://developers.weixin.qq.com/miniprogram/dev/framework/view/interactive-animation.html#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88\" target=\"_blank\" rel=\"noopener\">WXS响应事件</a>中，我隐隐得到了答案</li>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzZlYWJjYjdjOTliMzAxNWMwOGQwZmM2YWM3ZmMxMGMzNDU5NDAxLnBuZw?x-oss-process=image/format,png\" alt=\"wxs相应事件\"></li>\n<li>我们在页面级通过selectComponent实例化组件，对选中的组件进行操作，官方可以通过拷贝一份相同的组件，使我们便捷的将事件的处理从2次的逻辑层和渲染层通信以及一次渲染，减少到直接对页面上元素进行操作，即一次逻辑层和渲染层通信以及一次渲染。</li>\n<li>猜想二：问题层面是在微信开发者工具中的wxml，渲染方式对于这种情况就是这样处理的。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>官方已给出问题原因</p>\n<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzJkMWVkZmYyNWIwM2YxZDU2ZGVjYjZhM2NkYjAwMGU5NTE5ODQucG5n?x-oss-process=image/format,png\" alt=\"wxml面板\"></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"如何解决问题\"><a href=\"#如何解决问题\" class=\"headerlink\" title=\"如何解决问题\"></a>如何解决问题</h4><ul>\n<li>在popover以及popover-item加入  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">options: &#123;</span><br><span class=\"line\">\t\t    multipleSlots: <span class=\"literal\">true</span> <span class=\"comment\">// 在组件定义时的选项中启用多slot支持</span></span><br><span class=\"line\">\t\t  &#125;,</span><br></pre></td></tr></table></figure></li>\n<li>就可以解决了。最后建议slot中可以写上name这样代码可能会更易读。<h4 id=\"写在后面\"><a href=\"#写在后面\" class=\"headerlink\" title=\"写在后面\"></a>写在后面</h4></li>\n<li>祝大家多多发财</li>\n</ul>\n<hr>\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h4><ul>\n<li>记录基于<a href=\"https://developers.weixin.qq.com/community/develop/doc/000e4e7103c3c090e517e0cdb5b806\" target=\"_blank\" rel=\"noopener\">微信小程序-气泡框</a>实现中产生的问题及思考</li>\n</ul>\n<hr>\n<h4 id=\"问题截图\"><a href=\"#问题截图\" class=\"headerlink\" title=\"问题截图\"></a>问题截图</h4><p><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzlkMGY1NmUxOTVkNzFjMjAyYzVkYzI0OGMxMzg0NmUxMTQ3MTQucG5n?x-oss-process=image/format,png\" alt=\"popover问题截图\"></p>\n<h4 id=\"问题描述\"><a href=\"#问题描述\" class=\"headerlink\" title=\"问题描述\"></a>问题描述</h4><ul>\n<li>模拟器显示正常，但在真机上点击后，气泡框的箭头并没有消失，且点击同一级别区域，能利用覆盖消除箭头。【是不是一个很可爱的bug？</li>\n</ul>\n<h4 id=\"问题解决过程记录\"><a href=\"#问题解决过程记录\" class=\"headerlink\" title=\"问题解决过程记录\"></a>问题解决过程记录</h4><ul>\n<li><p>定位问题发生的原因范围</p>\n<ul>\n<li>样式<ul>\n<li>样式在判断显示条件(wx:if=”“)生效后，仍然渲染</li>\n<li>否定原因<ul>\n<li>查询代码发现，整个样式背景的设定是在::before伪元素选择器中</li>\n<li>且显示条件生效，在调试器中已没有该元素，但仍显示</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>逻辑<ul>\n<li>会不会是组件在渲染时，多渲染一份，我们使用判断条件进行开关时，只是对其中一个进行了操作</li>\n<li>怀疑依据<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzk5ZjcwMDAwZmViM2IwYzc0MWJmNjFiYzE5YTUwMDIxMjYyMTI3LnBuZw?x-oss-process=image/format,png\" alt=\"popover问题依据截图\"></li>\n<li>上图可见：在popover组件下，有2个通过&lt;slot&gt;插入的相同内容</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>开始解决问题</p>\n<ul>\n<li>查询官方关于<a href=\"https://developers.weixin.qq.com/miniprogram/dev/framework/custom-component/wxml-wxss.html\" target=\"_blank\" rel=\"noopener\">slot</a>方面的介绍<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JjMTE0ZmI0YTdhOWZkY2ZlYzU3ZDE5ZWQyYWY0YzI3MzE1NTU4LnBuZw?x-oss-process=image/format,png\" alt=\"官方slot基础例子\"></li>\n</ul>\n</li>\n<li>基于官方基础代码，复现问题<ul>\n<li>产生一个child-tag组件，并在其中编写  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// components/child-tag.js.js</span></span><br><span class=\"line\">Component(&#123;</span><br><span class=\"line\">  options: &#123;</span><br><span class=\"line\">    multipleSlots: <span class=\"literal\">true</span> <span class=\"comment\">// 在组件定义时的选项中启用多slot支持</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的属性列表</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  properties: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  relations: &#123;</span><br><span class=\"line\">    <span class=\"string\">'./component-tag-name'</span>: &#123;</span><br><span class=\"line\">      type: <span class=\"string\">'parent'</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的初始数据</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的方法列表</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n<li>与component-tag-name绑定形成父子组件  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// components/component-tag-name.js</span></span><br><span class=\"line\">Component(&#123;</span><br><span class=\"line\">  options: &#123;</span><br><span class=\"line\">    multipleSlots: <span class=\"literal\">true</span> <span class=\"comment\">// 在组件定义时的选项中启用多slot支持</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  relations: &#123;</span><br><span class=\"line\">    <span class=\"string\">'./child-tag'</span>: &#123;</span><br><span class=\"line\">      type: <span class=\"string\">'child'</span>,</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的属性列表</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  properties: &#123;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的初始数据</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  data: &#123;</span><br><span class=\"line\">    visible: <span class=\"literal\">false</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">   * 组件的方法列表</span></span><br><span class=\"line\"><span class=\"comment\">   */</span></span><br><span class=\"line\">  methods: &#123;</span><br><span class=\"line\">  </span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></li>\n<li>并将index.html中进行调用  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!-- 引用组件的页面模版 --&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">\"primary\"</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">\"onTap\"</span>&gt;</span>222<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">my-component</span> <span class=\"attr\">id</span>=<span class=\"string\">\"component\"</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">slot</span>=<span class=\"string\">\"content\"</span>&gt;</span></span><br><span class=\"line\">\t\t\t这里是插入到组件slot name=\"content\"中的内容</span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">child-component</span>&gt;</span></span><br><span class=\"line\">\t\t\t\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">slot</span>=<span class=\"string\">\"child\"</span>&gt;</span>这里是插入到组件slot name=\"child\"中的内容<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;/<span class=\"name\">child-component</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">my-component</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure></li>\n<li>但是其结构树仍然非常正常，并没有出现那个所谓的”拷贝”组件<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzcwNTRhNjJkYmM2MGEyNmU5ZGI1ODYzNzNjOGY2OTgyMzg3NTI0LnBuZw?x-oss-process=image/format,png\" alt=\"改写v1.1后的结构树截图\"></li>\n<li>仔细复现了几次，发现：多出来的那个组件会有所延迟。抓住这个问题，想到我们在onReady中，注册了该组件，于是，继续模拟</li>\n</ul>\n</li>\n<li>修改index.js代码，并在component-tag-name组件注册onTap方法，控制显隐  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">onReady() &#123;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.component = <span class=\"keyword\">this</span>.selectComponent(<span class=\"string\">'#component'</span>)</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">onTap() &#123;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'onTap'</span>)</span><br><span class=\"line\">  wx.createSelectorQuery().select(<span class=\"string\">'#component'</span>).boundingClientRect(<span class=\"function\"><span class=\"params\">res</span> =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 调用自定义组件 popover 中的 onDisplay 方法</span></span><br><span class=\"line\">      <span class=\"keyword\">this</span>.component.onTap();</span><br><span class=\"line\">  &#125;).exec();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>最终复现<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzhmZjQ3OTNhMjUwYTNjMzlhYjBlOGQxMGJhYTllZmI2NDc1NjIyLnBuZw?x-oss-process=image/format,png\" alt=\"官方模拟最终运行截图\"></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>得出问题来源：<ul>\n<li>在组件中进行了一次setData</li>\n</ul>\n</li>\n<li>思考背后问题<ul>\n<li>在组件中setData为什么会”拷贝“一份相同的在页面级wxml中？</li>\n<li>猜想一：从<a href=\"https://developers.weixin.qq.com/miniprogram/dev/framework/view/interactive-animation.html#%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%A1%88\" target=\"_blank\" rel=\"noopener\">WXS响应事件</a>中，我隐隐得到了答案</li>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzZlYWJjYjdjOTliMzAxNWMwOGQwZmM2YWM3ZmMxMGMzNDU5NDAxLnBuZw?x-oss-process=image/format,png\" alt=\"wxs相应事件\"></li>\n<li>我们在页面级通过selectComponent实例化组件，对选中的组件进行操作，官方可以通过拷贝一份相同的组件，使我们便捷的将事件的处理从2次的逻辑层和渲染层通信以及一次渲染，减少到直接对页面上元素进行操作，即一次逻辑层和渲染层通信以及一次渲染。</li>\n<li>猜想二：问题层面是在微信开发者工具中的wxml，渲染方式对于这种情况就是这样处理的。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li><p>官方已给出问题原因</p>\n<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzJkMWVkZmYyNWIwM2YxZDU2ZGVjYjZhM2NkYjAwMGU5NTE5ODQucG5n?x-oss-process=image/format,png\" alt=\"wxml面板\"></li>\n</ul>\n</li>\n</ul>\n<h4 id=\"如何解决问题\"><a href=\"#如何解决问题\" class=\"headerlink\" title=\"如何解决问题\"></a>如何解决问题</h4><ul>\n<li>在popover以及popover-item加入  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">options: &#123;</span><br><span class=\"line\">\t\t    multipleSlots: <span class=\"literal\">true</span> <span class=\"comment\">// 在组件定义时的选项中启用多slot支持</span></span><br><span class=\"line\">\t\t  &#125;,</span><br></pre></td></tr></table></figure></li>\n<li>就可以解决了。最后建议slot中可以写上name这样代码可能会更易读。<h4 id=\"写在后面\"><a href=\"#写在后面\" class=\"headerlink\" title=\"写在后面\"></a>写在后面</h4></li>\n<li>祝大家多多发财</li>\n</ul>\n<hr>\n"},{"layout":"微信小程序-fix","title":"canvas原生组件最顶层","date":"2020-04-05T04:04:24.000Z","_content":"\n#### 写在前面\n- 大家应该都知道过，在微信小程序中，canvas等原生组件的层级是最高的，页面中无论你设置多大的z-index都无法覆盖在其之上，这就可能会产生一些问题\n- 就像这样\n\t- ![canvas顶层问题截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UxYmQ5OTM2M2VkYjU1NTRmYjc5MzBlZDllMTA0ZjEwMTc2MDM0LnBuZw?x-oss-process=image/format,png)\n\t- 柱状图是用canvas画的，它置于了我的tooltip之上。【这看起来真是一个可怕的问题\n---\n\n#### 解决问题\n- 微信官方提供了[cover-view](https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html)原生组件，覆盖在原生组件之上的文本视图\n- 微信官方提供了将canvas转化为图片的方式--[wx.canvasToTempFilePath](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.canvasToTempFilePath.html)，这样就可以”降级“\n\n\n##### 方法一：cover-view\n- 将tooltip用cover-view改写，效果如下\n\t- ![cover-view version0.1 截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2Y0MTZjZjhlMjNiZWEwMjNjYTM1M2JhOGExMDM1MDM2MzYyOTIucG5n?x-oss-process=image/format,png)\n\t- 看上去，是解决了我们的问题，且tooltip后的灰色背景不能滑动了，【妈耶，好棒！\n\t- 但是，这产生了一个：**当文本超出tooltip宽度时，scroll-y: auto，失效了，溢出部分被直接截取**\n\t- 罪魁祸首就是它\n\t\t- ![cover内置样式](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2M5ZDljYjZiZTQ0ZGY3YmJmNmRlMjAxNDM1ZmYzOTJjNDMxNDMucG5n?x-oss-process=image/format,png)\n\t- 那我们可以：\n\t\t- 在tooltip分段内容中加上\n\t\t\t```css\n\t\t\t.modal-layer-content-rule {\n\t\t\t    white-space: pre-wrap;\n\t\t\t}\n\t\t\t```\n\t\t- 在内容wrapper中加上\n\t\t\t```css\n\t\t\t.modal-layer-content {\n\t\t\t    overflow: scroll;\n\t\t\t}\n\t\t\t```\n\t- 完美解决\n\t\t- ![cover-view解决图](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2FhZjRkMDAyODdjZGI4M2Y0NWRhMGVkOTg3Mzc5MGNhNDQxMjkucG5n?x-oss-process=image/format,png)\n##### 方法二：wx.canvasToTempFilePath\n- 首先我们要做的就是将网络图片绘制进canvas，官方关于canvas类型有两种\n![两种canvas类型](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2E4ZjJmNjA5OGYxNmQ4MzY3NWJiN2I3OWY0ZDM1NWM1MTAwMDg3LnBuZw?x-oss-process=image/format,png)\n- 新canvas 2D接口尝试\n\t```javascript\n\tconst query = wx.createSelectorQuery().in(this)\n    query.select('#myCanvas')\n      .fields({ node: true, size: true })\n      .exec((res) => {\n        const canvas = res[0].node\n        const ctx = canvas.getContext('2d')\n        const img = canvas.createImage()\n        img.onload = () => {\n          ctx.drawImage(img, 0, 0, 100, 100)\n        }\n        img.src = 'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'\n        // 这种方式获取canvas区域隐含的像素数据\n        console.log(ctx.getImageData(0, 0, 150, 100).data)\n      })\n\t```\n\t```html\n\t<canvas type=\"2d\" id=\"myCanvas\" canvas-id=\"myCanvas\"></canvas>\n\t```\n- 运行截图![canvas2d 运行截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzE5ZWE3ZGYxYjg2ODUzOWFhNzVhY2E0OTAxYzI2MzU2OTk4NDYucG5n?x-oss-process=image/format,png)\n- 第二种旧canvas\n\t```javascript\n\tconst ctx = wx.createCanvasContext('myCanvas')\n    wx.getImageInfo({\n        src: 'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg',\n        success: function (res) {\n          console.log('res', res)\n          const poster = res.path                                  \n          ctx.drawImage(poster, 0, 0, 150, 100)\n          ctx.draw()\n        }\n      })\n      // 这种方式获取canvas区域隐含的像素数据\n      wx.canvasGetImageData({\n        canvasId: 'myCanvas',\n        x: 0,\n        y: 0,\n        width: 150,\n        height: 100,\n        success(res) {\n          console.log(res.width) // 150\n          console.log(res.height) // 100\n          console.log(res.data instanceof Uint8ClampedArray) // true\n          console.log(res.data) // 150 * 100 * 4\n          console.log(res.data.length) // 150 * 100 * 4\n        }\n      })\n\t```\n\t```html\n\t<canvas id=\"myCanvas\" canvas-id=\"myCanvas\"></canvas>\n\t```\n- 运行截图![旧canvas](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzU4NTg5MzQ4MDc3Njk3OTA0OTRmZmIzOWRiNDdjMWRmNjk4ODQucG5n?x-oss-process=image/format,png)\n- 虽然两种方法，都能实现将网络图片绘制进canvas，但新版的进行了createImage，将其打印的话，其实就是新建了一个img标签，并将img标签的东西绘制进canvas\n\t- ![img console](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzFjMjE1NzMzZTRkY2UzNGZiNzI4NDFhZWEyMDc0ZWIwMjQ1OTQucG5n?x-oss-process=image/format,png)\n\t- 为什么微信官方会仅支持以下方式进行新版canvas2d 图片的绘制，考虑是什么？\n\t- ![经典报错](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JhYWQ1OWRhNDI4M2FjZmViZTY1NGQ0ZWZiNTAxZDZlMjAxMjE2LnBuZw?x-oss-process=image/format,png)\n- 现在我们要将canvas的内容导成图片，同样分成新旧两版\n- 主要思路都是：在wxml中，如果canvas绘制图片没有完成，则显示canvas内容，绘制完成后，就利用canvasToTempFilePath，将图层内容生成指定大小图片，显示image\n\t- canvas2d \n\t\t```javascript\n\t\tconst that = this\n\t    const query = wx.createSelectorQuery().in(this)\n\t    query.select('#myCanvas')\n\t      .fields({ node: true, size: true })\n\t      .exec((res) => {\n\t        const canvas = res[0].node\n\t        const ctx = canvas.getContext('2d')\n\t        const img = canvas.createImage()\n\t        console.log('img', img)\n\t        img.onload = () => {\n\t          ctx.drawImage(img, 0, 0, 100, 100)\n\t            wx.canvasToTempFilePath({\n\t              x: 0,\n\t              y: 0,\n\t              width: 100,\n\t              height: 100,\n\t              destWidth: 100,\n\t              destHeight: 100,\n\t              canvas: canvas,\n\t              success(res) {\n\t                that.setData({\n\t                  imgPath: res.tempFilePath\n\t                })\n\t              },\n\t              fail(err) {\n\t                console.log('err', err)\n\t              }\n\t            })\n\t        }\n\t        img.src = 'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'\n\t        // 这种方式获取canvas区域隐含的像素数据\n\t        console.log(ctx.getImageData(0, 0, 100, 100).data)\n\t      })\n\t\t```\n\t\t```html\n\t\t<canvas wx:if=\"{{!imgPath}}\" type=\"2d\" id=\"myCanvas\" canvas-id=\"myCanvas\" style=\"width: 330px;height: 340px;\"></canvas>\n\t\t<image wx:else src=\"{{imgPath}}\" style=\"width: 330px;height: 340px;\" />\n\t\t```\n\t\t- canvas2d 需要踩得坑是：它的官方文档🙃\n\t\t\t- ![canvas2d 转图片误导](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UwM2Q1ZDg0YzYyNmI0NzlmZjBjOTlmNzA1YmRhYjg5NDc5MjcucG5n?x-oss-process=image/format,png)\n\t\t\t- 尝试下来，会\n\t\t\t\t- ![ctx.draw报错](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UxMjRiY2Q3ZmNjYWI5ODBlNDdkMTk2YTMyZGQyODI4NDUzODcucG5n?x-oss-process=image/format,png)\n\t\t\t- 那我们可以继续往下看\n\t\t\t\t- ![canvas2d tempath正确实力](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2YxODk5NWFiNDY4N2IwYmZlYzhjZTZkZWU2ZWQxYmZjMTA1MTY1LnBuZw?x-oss-process=image/format,png)这才是符合我们需要\n\t\t- 运行截图\n\t\t\t- ![canvas2d运行截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JmMzVlMzY4YzRjMmRhYTgxNTA0NzM0YTIxZGMxM2I2NDYwNzIucG5n?x-oss-process=image/format,png)\n\t- 旧版canvas\n\t\t```javascript\n\t    const ctx = wx.createCanvasContext('myCanvas')\n\t    const that = this\n\t    wx.getImageInfo({\n\t      src: 'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg',\n\t      success: function (res) {\n\t        console.log('res', res)\n\t        const poster = res.path\n\t        ctx.drawImage(poster, 0, 0, 150, 100)\n\t        ctx.draw(false, () => {\n\t          wx.canvasToTempFilePath({\n\t            x: 0,\n\t            y: 0,\n\t            width: 100,\n\t            height: 100,\n\t            destWidth: 100,\n\t            destHeight: 100,\n\t            canvasId: \"myCanvas\",\n\t            success(res) {\n\t              that.setData({\n\t                imgPath: res.tempFilePath\n\t              })\n\t              console.log(res.tempFilePath)\n\t            },\n\t            fail(err) {\n\t              console.log('err', err)\n\t            }\n\t          })\n\t        })\n\t        // 这种方式获取canvas区域隐含的像素数据\n\t        wx.canvasGetImageData({\n\t          canvasId: 'myCanvas',\n\t          x: 0,\n\t          y: 0,\n\t          width: 150,\n\t          height: 100,\n\t          success(res) {\n\t            console.log(res.width) // 150\n\t            console.log(res.height) // 100\n\t            console.log(res.data instanceof Uint8ClampedArray) // true\n\t            console.log(res.data) // 150 * 100 * 4\n\t            console.log(res.data.length) // 150 * 100 * 4\n\t          }\n\t        })\n\t      }\n\t    })\n\t\t```\n\t\t```html\n\t\t<canvas wx:if=\"{{!imgPath}}\" id=\"myCanvas\" canvas-id=\"myCanvas\" style=\"width: 330px;height: 340px;\"></canvas>\n\t\t<image wx:else src=\"{{imgPath}}\" style=\"width: 330px;height: 340px;\" />\n\t\t```\n\t\t- 运行截图\n\t\t\t- ![旧版canvas运行截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2EzZTRiYTBkYzc2NDgzYTM1NTYxZDcwNDUzNzZkNjZmNDU5MTgucG5n?x-oss-process=image/format,png)\n#### 写在后面\n- 感谢[Skady宝贝](https://github.com/skadieyes)在探讨问题中给予的帮助，欢迎大家去github找她玩👈\n- 祝大家多多发财\n----\n\t\t\n","source":"_posts/canvas原生组件最顶层.md","raw":"---\nlayout: 微信小程序-fix\ntitle: canvas原生组件最顶层\ndate: 2020-04-05 12:04:24\ntags: \n- 微信小程序\ncategories:\n- 微信小程序\n\n\n---\n\n#### 写在前面\n- 大家应该都知道过，在微信小程序中，canvas等原生组件的层级是最高的，页面中无论你设置多大的z-index都无法覆盖在其之上，这就可能会产生一些问题\n- 就像这样\n\t- ![canvas顶层问题截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UxYmQ5OTM2M2VkYjU1NTRmYjc5MzBlZDllMTA0ZjEwMTc2MDM0LnBuZw?x-oss-process=image/format,png)\n\t- 柱状图是用canvas画的，它置于了我的tooltip之上。【这看起来真是一个可怕的问题\n---\n\n#### 解决问题\n- 微信官方提供了[cover-view](https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html)原生组件，覆盖在原生组件之上的文本视图\n- 微信官方提供了将canvas转化为图片的方式--[wx.canvasToTempFilePath](https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.canvasToTempFilePath.html)，这样就可以”降级“\n\n\n##### 方法一：cover-view\n- 将tooltip用cover-view改写，效果如下\n\t- ![cover-view version0.1 截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2Y0MTZjZjhlMjNiZWEwMjNjYTM1M2JhOGExMDM1MDM2MzYyOTIucG5n?x-oss-process=image/format,png)\n\t- 看上去，是解决了我们的问题，且tooltip后的灰色背景不能滑动了，【妈耶，好棒！\n\t- 但是，这产生了一个：**当文本超出tooltip宽度时，scroll-y: auto，失效了，溢出部分被直接截取**\n\t- 罪魁祸首就是它\n\t\t- ![cover内置样式](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2M5ZDljYjZiZTQ0ZGY3YmJmNmRlMjAxNDM1ZmYzOTJjNDMxNDMucG5n?x-oss-process=image/format,png)\n\t- 那我们可以：\n\t\t- 在tooltip分段内容中加上\n\t\t\t```css\n\t\t\t.modal-layer-content-rule {\n\t\t\t    white-space: pre-wrap;\n\t\t\t}\n\t\t\t```\n\t\t- 在内容wrapper中加上\n\t\t\t```css\n\t\t\t.modal-layer-content {\n\t\t\t    overflow: scroll;\n\t\t\t}\n\t\t\t```\n\t- 完美解决\n\t\t- ![cover-view解决图](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2FhZjRkMDAyODdjZGI4M2Y0NWRhMGVkOTg3Mzc5MGNhNDQxMjkucG5n?x-oss-process=image/format,png)\n##### 方法二：wx.canvasToTempFilePath\n- 首先我们要做的就是将网络图片绘制进canvas，官方关于canvas类型有两种\n![两种canvas类型](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2E4ZjJmNjA5OGYxNmQ4MzY3NWJiN2I3OWY0ZDM1NWM1MTAwMDg3LnBuZw?x-oss-process=image/format,png)\n- 新canvas 2D接口尝试\n\t```javascript\n\tconst query = wx.createSelectorQuery().in(this)\n    query.select('#myCanvas')\n      .fields({ node: true, size: true })\n      .exec((res) => {\n        const canvas = res[0].node\n        const ctx = canvas.getContext('2d')\n        const img = canvas.createImage()\n        img.onload = () => {\n          ctx.drawImage(img, 0, 0, 100, 100)\n        }\n        img.src = 'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'\n        // 这种方式获取canvas区域隐含的像素数据\n        console.log(ctx.getImageData(0, 0, 150, 100).data)\n      })\n\t```\n\t```html\n\t<canvas type=\"2d\" id=\"myCanvas\" canvas-id=\"myCanvas\"></canvas>\n\t```\n- 运行截图![canvas2d 运行截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzE5ZWE3ZGYxYjg2ODUzOWFhNzVhY2E0OTAxYzI2MzU2OTk4NDYucG5n?x-oss-process=image/format,png)\n- 第二种旧canvas\n\t```javascript\n\tconst ctx = wx.createCanvasContext('myCanvas')\n    wx.getImageInfo({\n        src: 'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg',\n        success: function (res) {\n          console.log('res', res)\n          const poster = res.path                                  \n          ctx.drawImage(poster, 0, 0, 150, 100)\n          ctx.draw()\n        }\n      })\n      // 这种方式获取canvas区域隐含的像素数据\n      wx.canvasGetImageData({\n        canvasId: 'myCanvas',\n        x: 0,\n        y: 0,\n        width: 150,\n        height: 100,\n        success(res) {\n          console.log(res.width) // 150\n          console.log(res.height) // 100\n          console.log(res.data instanceof Uint8ClampedArray) // true\n          console.log(res.data) // 150 * 100 * 4\n          console.log(res.data.length) // 150 * 100 * 4\n        }\n      })\n\t```\n\t```html\n\t<canvas id=\"myCanvas\" canvas-id=\"myCanvas\"></canvas>\n\t```\n- 运行截图![旧canvas](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzU4NTg5MzQ4MDc3Njk3OTA0OTRmZmIzOWRiNDdjMWRmNjk4ODQucG5n?x-oss-process=image/format,png)\n- 虽然两种方法，都能实现将网络图片绘制进canvas，但新版的进行了createImage，将其打印的话，其实就是新建了一个img标签，并将img标签的东西绘制进canvas\n\t- ![img console](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzFjMjE1NzMzZTRkY2UzNGZiNzI4NDFhZWEyMDc0ZWIwMjQ1OTQucG5n?x-oss-process=image/format,png)\n\t- 为什么微信官方会仅支持以下方式进行新版canvas2d 图片的绘制，考虑是什么？\n\t- ![经典报错](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JhYWQ1OWRhNDI4M2FjZmViZTY1NGQ0ZWZiNTAxZDZlMjAxMjE2LnBuZw?x-oss-process=image/format,png)\n- 现在我们要将canvas的内容导成图片，同样分成新旧两版\n- 主要思路都是：在wxml中，如果canvas绘制图片没有完成，则显示canvas内容，绘制完成后，就利用canvasToTempFilePath，将图层内容生成指定大小图片，显示image\n\t- canvas2d \n\t\t```javascript\n\t\tconst that = this\n\t    const query = wx.createSelectorQuery().in(this)\n\t    query.select('#myCanvas')\n\t      .fields({ node: true, size: true })\n\t      .exec((res) => {\n\t        const canvas = res[0].node\n\t        const ctx = canvas.getContext('2d')\n\t        const img = canvas.createImage()\n\t        console.log('img', img)\n\t        img.onload = () => {\n\t          ctx.drawImage(img, 0, 0, 100, 100)\n\t            wx.canvasToTempFilePath({\n\t              x: 0,\n\t              y: 0,\n\t              width: 100,\n\t              height: 100,\n\t              destWidth: 100,\n\t              destHeight: 100,\n\t              canvas: canvas,\n\t              success(res) {\n\t                that.setData({\n\t                  imgPath: res.tempFilePath\n\t                })\n\t              },\n\t              fail(err) {\n\t                console.log('err', err)\n\t              }\n\t            })\n\t        }\n\t        img.src = 'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'\n\t        // 这种方式获取canvas区域隐含的像素数据\n\t        console.log(ctx.getImageData(0, 0, 100, 100).data)\n\t      })\n\t\t```\n\t\t```html\n\t\t<canvas wx:if=\"{{!imgPath}}\" type=\"2d\" id=\"myCanvas\" canvas-id=\"myCanvas\" style=\"width: 330px;height: 340px;\"></canvas>\n\t\t<image wx:else src=\"{{imgPath}}\" style=\"width: 330px;height: 340px;\" />\n\t\t```\n\t\t- canvas2d 需要踩得坑是：它的官方文档🙃\n\t\t\t- ![canvas2d 转图片误导](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UwM2Q1ZDg0YzYyNmI0NzlmZjBjOTlmNzA1YmRhYjg5NDc5MjcucG5n?x-oss-process=image/format,png)\n\t\t\t- 尝试下来，会\n\t\t\t\t- ![ctx.draw报错](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UxMjRiY2Q3ZmNjYWI5ODBlNDdkMTk2YTMyZGQyODI4NDUzODcucG5n?x-oss-process=image/format,png)\n\t\t\t- 那我们可以继续往下看\n\t\t\t\t- ![canvas2d tempath正确实力](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2YxODk5NWFiNDY4N2IwYmZlYzhjZTZkZWU2ZWQxYmZjMTA1MTY1LnBuZw?x-oss-process=image/format,png)这才是符合我们需要\n\t\t- 运行截图\n\t\t\t- ![canvas2d运行截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JmMzVlMzY4YzRjMmRhYTgxNTA0NzM0YTIxZGMxM2I2NDYwNzIucG5n?x-oss-process=image/format,png)\n\t- 旧版canvas\n\t\t```javascript\n\t    const ctx = wx.createCanvasContext('myCanvas')\n\t    const that = this\n\t    wx.getImageInfo({\n\t      src: 'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg',\n\t      success: function (res) {\n\t        console.log('res', res)\n\t        const poster = res.path\n\t        ctx.drawImage(poster, 0, 0, 150, 100)\n\t        ctx.draw(false, () => {\n\t          wx.canvasToTempFilePath({\n\t            x: 0,\n\t            y: 0,\n\t            width: 100,\n\t            height: 100,\n\t            destWidth: 100,\n\t            destHeight: 100,\n\t            canvasId: \"myCanvas\",\n\t            success(res) {\n\t              that.setData({\n\t                imgPath: res.tempFilePath\n\t              })\n\t              console.log(res.tempFilePath)\n\t            },\n\t            fail(err) {\n\t              console.log('err', err)\n\t            }\n\t          })\n\t        })\n\t        // 这种方式获取canvas区域隐含的像素数据\n\t        wx.canvasGetImageData({\n\t          canvasId: 'myCanvas',\n\t          x: 0,\n\t          y: 0,\n\t          width: 150,\n\t          height: 100,\n\t          success(res) {\n\t            console.log(res.width) // 150\n\t            console.log(res.height) // 100\n\t            console.log(res.data instanceof Uint8ClampedArray) // true\n\t            console.log(res.data) // 150 * 100 * 4\n\t            console.log(res.data.length) // 150 * 100 * 4\n\t          }\n\t        })\n\t      }\n\t    })\n\t\t```\n\t\t```html\n\t\t<canvas wx:if=\"{{!imgPath}}\" id=\"myCanvas\" canvas-id=\"myCanvas\" style=\"width: 330px;height: 340px;\"></canvas>\n\t\t<image wx:else src=\"{{imgPath}}\" style=\"width: 330px;height: 340px;\" />\n\t\t```\n\t\t- 运行截图\n\t\t\t- ![旧版canvas运行截图](https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2EzZTRiYTBkYzc2NDgzYTM1NTYxZDcwNDUzNzZkNjZmNDU5MTgucG5n?x-oss-process=image/format,png)\n#### 写在后面\n- 感谢[Skady宝贝](https://github.com/skadieyes)在探讨问题中给予的帮助，欢迎大家去github找她玩👈\n- 祝大家多多发财\n----\n\t\t\n","slug":"canvas原生组件最顶层","published":1,"updated":"2020-04-05T04:05:09.735Z","comments":1,"photos":[],"link":"","_id":"ck8mivy7t0000dvp38a1j7n56","content":"<h4 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h4><ul>\n<li>大家应该都知道过，在微信小程序中，canvas等原生组件的层级是最高的，页面中无论你设置多大的z-index都无法覆盖在其之上，这就可能会产生一些问题</li>\n<li>就像这样<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UxYmQ5OTM2M2VkYjU1NTRmYjc5MzBlZDllMTA0ZjEwMTc2MDM0LnBuZw?x-oss-process=image/format,png\" alt=\"canvas顶层问题截图\"></li>\n<li>柱状图是用canvas画的，它置于了我的tooltip之上。【这看起来真是一个可怕的问题</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h4 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h4><ul>\n<li>微信官方提供了<a href=\"https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html\" target=\"_blank\" rel=\"noopener\">cover-view</a>原生组件，覆盖在原生组件之上的文本视图</li>\n<li>微信官方提供了将canvas转化为图片的方式–<a href=\"https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.canvasToTempFilePath.html\" target=\"_blank\" rel=\"noopener\">wx.canvasToTempFilePath</a>，这样就可以”降级“</li>\n</ul>\n<h5 id=\"方法一：cover-view\"><a href=\"#方法一：cover-view\" class=\"headerlink\" title=\"方法一：cover-view\"></a>方法一：cover-view</h5><ul>\n<li>将tooltip用cover-view改写，效果如下<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2Y0MTZjZjhlMjNiZWEwMjNjYTM1M2JhOGExMDM1MDM2MzYyOTIucG5n?x-oss-process=image/format,png\" alt=\"cover-view version0.1 截图\"></li>\n<li>看上去，是解决了我们的问题，且tooltip后的灰色背景不能滑动了，【妈耶，好棒！</li>\n<li>但是，这产生了一个：<strong>当文本超出tooltip宽度时，scroll-y: auto，失效了，溢出部分被直接截取</strong></li>\n<li>罪魁祸首就是它<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2M5ZDljYjZiZTQ0ZGY3YmJmNmRlMjAxNDM1ZmYzOTJjNDMxNDMucG5n?x-oss-process=image/format,png\" alt=\"cover内置样式\"></li>\n</ul>\n</li>\n<li>那我们可以：<ul>\n<li>在tooltip分段内容中加上  <figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.modal-layer-content-rule</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">white-space</span>: pre-wrap;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>在内容wrapper中加上  <figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.modal-layer-content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: scroll;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>完美解决<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2FhZjRkMDAyODdjZGI4M2Y0NWRhMGVkOTg3Mzc5MGNhNDQxMjkucG5n?x-oss-process=image/format,png\" alt=\"cover-view解决图\"><h5 id=\"方法二：wx-canvasToTempFilePath\"><a href=\"#方法二：wx-canvasToTempFilePath\" class=\"headerlink\" title=\"方法二：wx.canvasToTempFilePath\"></a>方法二：wx.canvasToTempFilePath</h5></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>首先我们要做的就是将网络图片绘制进canvas，官方关于canvas类型有两种<br><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2E4ZjJmNjA5OGYxNmQ4MzY3NWJiN2I3OWY0ZDM1NWM1MTAwMDg3LnBuZw?x-oss-process=image/format,png\" alt=\"两种canvas类型\"></li>\n<li>新canvas 2D接口尝试  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> query = wx.createSelectorQuery().in(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">   query.select(<span class=\"string\">'#myCanvas'</span>)</span><br><span class=\"line\">     .fields(&#123; <span class=\"attr\">node</span>: <span class=\"literal\">true</span>, <span class=\"attr\">size</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\">     .exec(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">       <span class=\"keyword\">const</span> canvas = res[<span class=\"number\">0</span>].node</span><br><span class=\"line\">       <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>)</span><br><span class=\"line\">       <span class=\"keyword\">const</span> img = canvas.createImage()</span><br><span class=\"line\">       img.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">         ctx.drawImage(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       img.src = <span class=\"string\">'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'</span></span><br><span class=\"line\">       <span class=\"comment\">// 这种方式获取canvas区域隐含的像素数据</span></span><br><span class=\"line\">       <span class=\"built_in\">console</span>.log(ctx.getImageData(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">150</span>, <span class=\"number\">100</span>).data)</span><br><span class=\"line\">     &#125;)</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">type</span>=<span class=\"string\">\"2d\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">\"myCanvas\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure></li>\n<li>运行截图<img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzE5ZWE3ZGYxYjg2ODUzOWFhNzVhY2E0OTAxYzI2MzU2OTk4NDYucG5n?x-oss-process=image/format,png\" alt=\"canvas2d 运行截图\"></li>\n<li>第二种旧canvas  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ctx = wx.createCanvasContext(<span class=\"string\">'myCanvas'</span>)</span><br><span class=\"line\">   wx.getImageInfo(&#123;</span><br><span class=\"line\">       src: <span class=\"string\">'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'</span>,</span><br><span class=\"line\">       success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(<span class=\"string\">'res'</span>, res)</span><br><span class=\"line\">         <span class=\"keyword\">const</span> poster = res.path                                  </span><br><span class=\"line\">         ctx.drawImage(poster, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">150</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">         ctx.draw()</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;)</span><br><span class=\"line\">     <span class=\"comment\">// 这种方式获取canvas区域隐含的像素数据</span></span><br><span class=\"line\">     wx.canvasGetImageData(&#123;</span><br><span class=\"line\">       canvasId: <span class=\"string\">'myCanvas'</span>,</span><br><span class=\"line\">       x: <span class=\"number\">0</span>,</span><br><span class=\"line\">       y: <span class=\"number\">0</span>,</span><br><span class=\"line\">       width: <span class=\"number\">150</span>,</span><br><span class=\"line\">       height: <span class=\"number\">100</span>,</span><br><span class=\"line\">       success(res) &#123;</span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(res.width) <span class=\"comment\">// 150</span></span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(res.height) <span class=\"comment\">// 100</span></span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(res.data <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Uint8ClampedArray</span>) <span class=\"comment\">// true</span></span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(res.data) <span class=\"comment\">// 150 * 100 * 4</span></span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(res.data.length) <span class=\"comment\">// 150 * 100 * 4</span></span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;)</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">\"myCanvas\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure></li>\n<li>运行截图<img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzU4NTg5MzQ4MDc3Njk3OTA0OTRmZmIzOWRiNDdjMWRmNjk4ODQucG5n?x-oss-process=image/format,png\" alt=\"旧canvas\"></li>\n<li>虽然两种方法，都能实现将网络图片绘制进canvas，但新版的进行了createImage，将其打印的话，其实就是新建了一个img标签，并将img标签的东西绘制进canvas<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzFjMjE1NzMzZTRkY2UzNGZiNzI4NDFhZWEyMDc0ZWIwMjQ1OTQucG5n?x-oss-process=image/format,png\" alt=\"img console\"></li>\n<li>为什么微信官方会仅支持以下方式进行新版canvas2d 图片的绘制，考虑是什么？</li>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JhYWQ1OWRhNDI4M2FjZmViZTY1NGQ0ZWZiNTAxZDZlMjAxMjE2LnBuZw?x-oss-process=image/format,png\" alt=\"经典报错\"></li>\n</ul>\n</li>\n<li>现在我们要将canvas的内容导成图片，同样分成新旧两版</li>\n<li>主要思路都是：在wxml中，如果canvas绘制图片没有完成，则显示canvas内容，绘制完成后，就利用canvasToTempFilePath，将图层内容生成指定大小图片，显示image<ul>\n<li>canvas2d   <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> that = <span class=\"keyword\">this</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> query = wx.createSelectorQuery().in(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">   query.select(<span class=\"string\">'#myCanvas'</span>)</span><br><span class=\"line\">     .fields(&#123; <span class=\"attr\">node</span>: <span class=\"literal\">true</span>, <span class=\"attr\">size</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\">     .exec(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">       <span class=\"keyword\">const</span> canvas = res[<span class=\"number\">0</span>].node</span><br><span class=\"line\">       <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>)</span><br><span class=\"line\">       <span class=\"keyword\">const</span> img = canvas.createImage()</span><br><span class=\"line\">       <span class=\"built_in\">console</span>.log(<span class=\"string\">'img'</span>, img)</span><br><span class=\"line\">       img.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">         ctx.drawImage(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">           wx.canvasToTempFilePath(&#123;</span><br><span class=\"line\">             x: <span class=\"number\">0</span>,</span><br><span class=\"line\">             y: <span class=\"number\">0</span>,</span><br><span class=\"line\">             width: <span class=\"number\">100</span>,</span><br><span class=\"line\">             height: <span class=\"number\">100</span>,</span><br><span class=\"line\">             destWidth: <span class=\"number\">100</span>,</span><br><span class=\"line\">             destHeight: <span class=\"number\">100</span>,</span><br><span class=\"line\">             canvas: canvas,</span><br><span class=\"line\">             success(res) &#123;</span><br><span class=\"line\">               that.setData(&#123;</span><br><span class=\"line\">                 imgPath: res.tempFilePath</span><br><span class=\"line\">               &#125;)</span><br><span class=\"line\">             &#125;,</span><br><span class=\"line\">             fail(err) &#123;</span><br><span class=\"line\">               <span class=\"built_in\">console</span>.log(<span class=\"string\">'err'</span>, err)</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">           &#125;)</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       img.src = <span class=\"string\">'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'</span></span><br><span class=\"line\">       <span class=\"comment\">// 这种方式获取canvas区域隐含的像素数据</span></span><br><span class=\"line\">       <span class=\"built_in\">console</span>.log(ctx.getImageData(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>).data)</span><br><span class=\"line\">     &#125;)</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">\"&#123;&#123;!imgPath&#125;&#125;\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"2d\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 330px;height: 340px;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">wx:else</span> <span class=\"attr\">src</span>=<span class=\"string\">\"&#123;&#123;imgPath&#125;&#125;\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 330px;height: 340px;\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>canvas2d 需要踩得坑是：它的官方文档🙃<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UwM2Q1ZDg0YzYyNmI0NzlmZjBjOTlmNzA1YmRhYjg5NDc5MjcucG5n?x-oss-process=image/format,png\" alt=\"canvas2d 转图片误导\"></li>\n<li>尝试下来，会<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UxMjRiY2Q3ZmNjYWI5ODBlNDdkMTk2YTMyZGQyODI4NDUzODcucG5n?x-oss-process=image/format,png\" alt=\"ctx.draw报错\"></li>\n</ul>\n</li>\n<li>那我们可以继续往下看<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2YxODk5NWFiNDY4N2IwYmZlYzhjZTZkZWU2ZWQxYmZjMTA1MTY1LnBuZw?x-oss-process=image/format,png\" alt=\"canvas2d tempath正确实力\">这才是符合我们需要</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>运行截图<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JmMzVlMzY4YzRjMmRhYTgxNTA0NzM0YTIxZGMxM2I2NDYwNzIucG5n?x-oss-process=image/format,png\" alt=\"canvas2d运行截图\"></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>旧版canvas  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ctx = wx.createCanvasContext(<span class=\"string\">'myCanvas'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> that = <span class=\"keyword\">this</span></span><br><span class=\"line\">wx.getImageInfo(&#123;</span><br><span class=\"line\">  src: <span class=\"string\">'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'</span>,</span><br><span class=\"line\">  success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'res'</span>, res)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> poster = res.path</span><br><span class=\"line\">    ctx.drawImage(poster, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">150</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">    ctx.draw(<span class=\"literal\">false</span>, () =&gt; &#123;</span><br><span class=\"line\">      wx.canvasToTempFilePath(&#123;</span><br><span class=\"line\">        x: <span class=\"number\">0</span>,</span><br><span class=\"line\">        y: <span class=\"number\">0</span>,</span><br><span class=\"line\">        width: <span class=\"number\">100</span>,</span><br><span class=\"line\">        height: <span class=\"number\">100</span>,</span><br><span class=\"line\">        destWidth: <span class=\"number\">100</span>,</span><br><span class=\"line\">        destHeight: <span class=\"number\">100</span>,</span><br><span class=\"line\">        canvasId: <span class=\"string\">\"myCanvas\"</span>,</span><br><span class=\"line\">        success(res) &#123;</span><br><span class=\"line\">          that.setData(&#123;</span><br><span class=\"line\">            imgPath: res.tempFilePath</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(res.tempFilePath)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        fail(err) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">'err'</span>, err)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// 这种方式获取canvas区域隐含的像素数据</span></span><br><span class=\"line\">    wx.canvasGetImageData(&#123;</span><br><span class=\"line\">      canvasId: <span class=\"string\">'myCanvas'</span>,</span><br><span class=\"line\">      x: <span class=\"number\">0</span>,</span><br><span class=\"line\">      y: <span class=\"number\">0</span>,</span><br><span class=\"line\">      width: <span class=\"number\">150</span>,</span><br><span class=\"line\">      height: <span class=\"number\">100</span>,</span><br><span class=\"line\">      success(res) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res.width) <span class=\"comment\">// 150</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res.height) <span class=\"comment\">// 100</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res.data <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Uint8ClampedArray</span>) <span class=\"comment\">// true</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res.data) <span class=\"comment\">// 150 * 100 * 4</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res.data.length) <span class=\"comment\">// 150 * 100 * 4</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">\"&#123;&#123;!imgPath&#125;&#125;\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 330px;height: 340px;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">wx:else</span> <span class=\"attr\">src</span>=<span class=\"string\">\"&#123;&#123;imgPath&#125;&#125;\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 330px;height: 340px;\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>运行截图<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2EzZTRiYTBkYzc2NDgzYTM1NTYxZDcwNDUzNzZkNjZmNDU5MTgucG5n?x-oss-process=image/format,png\" alt=\"旧版canvas运行截图\"><h4 id=\"写在后面\"><a href=\"#写在后面\" class=\"headerlink\" title=\"写在后面\"></a>写在后面</h4></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>感谢<a href=\"https://github.com/skadieyes\" target=\"_blank\" rel=\"noopener\">Skady宝贝</a>在探讨问题中给予的帮助，欢迎大家去github找她玩👈</li>\n<li>祝大家多多发财</li>\n</ul>\n<hr>\n","site":{"data":{}},"excerpt":"","more":"<h4 id=\"写在前面\"><a href=\"#写在前面\" class=\"headerlink\" title=\"写在前面\"></a>写在前面</h4><ul>\n<li>大家应该都知道过，在微信小程序中，canvas等原生组件的层级是最高的，页面中无论你设置多大的z-index都无法覆盖在其之上，这就可能会产生一些问题</li>\n<li>就像这样<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UxYmQ5OTM2M2VkYjU1NTRmYjc5MzBlZDllMTA0ZjEwMTc2MDM0LnBuZw?x-oss-process=image/format,png\" alt=\"canvas顶层问题截图\"></li>\n<li>柱状图是用canvas画的，它置于了我的tooltip之上。【这看起来真是一个可怕的问题</li>\n</ul>\n</li>\n</ul>\n<hr>\n<h4 id=\"解决问题\"><a href=\"#解决问题\" class=\"headerlink\" title=\"解决问题\"></a>解决问题</h4><ul>\n<li>微信官方提供了<a href=\"https://developers.weixin.qq.com/miniprogram/dev/component/cover-view.html\" target=\"_blank\" rel=\"noopener\">cover-view</a>原生组件，覆盖在原生组件之上的文本视图</li>\n<li>微信官方提供了将canvas转化为图片的方式–<a href=\"https://developers.weixin.qq.com/miniprogram/dev/api/canvas/wx.canvasToTempFilePath.html\" target=\"_blank\" rel=\"noopener\">wx.canvasToTempFilePath</a>，这样就可以”降级“</li>\n</ul>\n<h5 id=\"方法一：cover-view\"><a href=\"#方法一：cover-view\" class=\"headerlink\" title=\"方法一：cover-view\"></a>方法一：cover-view</h5><ul>\n<li>将tooltip用cover-view改写，效果如下<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2Y0MTZjZjhlMjNiZWEwMjNjYTM1M2JhOGExMDM1MDM2MzYyOTIucG5n?x-oss-process=image/format,png\" alt=\"cover-view version0.1 截图\"></li>\n<li>看上去，是解决了我们的问题，且tooltip后的灰色背景不能滑动了，【妈耶，好棒！</li>\n<li>但是，这产生了一个：<strong>当文本超出tooltip宽度时，scroll-y: auto，失效了，溢出部分被直接截取</strong></li>\n<li>罪魁祸首就是它<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2M5ZDljYjZiZTQ0ZGY3YmJmNmRlMjAxNDM1ZmYzOTJjNDMxNDMucG5n?x-oss-process=image/format,png\" alt=\"cover内置样式\"></li>\n</ul>\n</li>\n<li>那我们可以：<ul>\n<li>在tooltip分段内容中加上  <figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.modal-layer-content-rule</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">white-space</span>: pre-wrap;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n<li>在内容wrapper中加上  <figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.modal-layer-content</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">overflow</span>: scroll;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li>完美解决<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2FhZjRkMDAyODdjZGI4M2Y0NWRhMGVkOTg3Mzc5MGNhNDQxMjkucG5n?x-oss-process=image/format,png\" alt=\"cover-view解决图\"><h5 id=\"方法二：wx-canvasToTempFilePath\"><a href=\"#方法二：wx-canvasToTempFilePath\" class=\"headerlink\" title=\"方法二：wx.canvasToTempFilePath\"></a>方法二：wx.canvasToTempFilePath</h5></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>首先我们要做的就是将网络图片绘制进canvas，官方关于canvas类型有两种<br><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2E4ZjJmNjA5OGYxNmQ4MzY3NWJiN2I3OWY0ZDM1NWM1MTAwMDg3LnBuZw?x-oss-process=image/format,png\" alt=\"两种canvas类型\"></li>\n<li>新canvas 2D接口尝试  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> query = wx.createSelectorQuery().in(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">   query.select(<span class=\"string\">'#myCanvas'</span>)</span><br><span class=\"line\">     .fields(&#123; <span class=\"attr\">node</span>: <span class=\"literal\">true</span>, <span class=\"attr\">size</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\">     .exec(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">       <span class=\"keyword\">const</span> canvas = res[<span class=\"number\">0</span>].node</span><br><span class=\"line\">       <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>)</span><br><span class=\"line\">       <span class=\"keyword\">const</span> img = canvas.createImage()</span><br><span class=\"line\">       img.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">         ctx.drawImage(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       img.src = <span class=\"string\">'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'</span></span><br><span class=\"line\">       <span class=\"comment\">// 这种方式获取canvas区域隐含的像素数据</span></span><br><span class=\"line\">       <span class=\"built_in\">console</span>.log(ctx.getImageData(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">150</span>, <span class=\"number\">100</span>).data)</span><br><span class=\"line\">     &#125;)</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">type</span>=<span class=\"string\">\"2d\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">\"myCanvas\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure></li>\n<li>运行截图<img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzE5ZWE3ZGYxYjg2ODUzOWFhNzVhY2E0OTAxYzI2MzU2OTk4NDYucG5n?x-oss-process=image/format,png\" alt=\"canvas2d 运行截图\"></li>\n<li>第二种旧canvas  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ctx = wx.createCanvasContext(<span class=\"string\">'myCanvas'</span>)</span><br><span class=\"line\">   wx.getImageInfo(&#123;</span><br><span class=\"line\">       src: <span class=\"string\">'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'</span>,</span><br><span class=\"line\">       success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(<span class=\"string\">'res'</span>, res)</span><br><span class=\"line\">         <span class=\"keyword\">const</span> poster = res.path                                  </span><br><span class=\"line\">         ctx.drawImage(poster, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">150</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">         ctx.draw()</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;)</span><br><span class=\"line\">     <span class=\"comment\">// 这种方式获取canvas区域隐含的像素数据</span></span><br><span class=\"line\">     wx.canvasGetImageData(&#123;</span><br><span class=\"line\">       canvasId: <span class=\"string\">'myCanvas'</span>,</span><br><span class=\"line\">       x: <span class=\"number\">0</span>,</span><br><span class=\"line\">       y: <span class=\"number\">0</span>,</span><br><span class=\"line\">       width: <span class=\"number\">150</span>,</span><br><span class=\"line\">       height: <span class=\"number\">100</span>,</span><br><span class=\"line\">       success(res) &#123;</span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(res.width) <span class=\"comment\">// 150</span></span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(res.height) <span class=\"comment\">// 100</span></span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(res.data <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Uint8ClampedArray</span>) <span class=\"comment\">// true</span></span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(res.data) <span class=\"comment\">// 150 * 100 * 4</span></span><br><span class=\"line\">         <span class=\"built_in\">console</span>.log(res.data.length) <span class=\"comment\">// 150 * 100 * 4</span></span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;)</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">\"myCanvas\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure></li>\n<li>运行截图<img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzU4NTg5MzQ4MDc3Njk3OTA0OTRmZmIzOWRiNDdjMWRmNjk4ODQucG5n?x-oss-process=image/format,png\" alt=\"旧canvas\"></li>\n<li>虽然两种方法，都能实现将网络图片绘制进canvas，但新版的进行了createImage，将其打印的话，其实就是新建了一个img标签，并将img标签的东西绘制进canvas<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlLzFjMjE1NzMzZTRkY2UzNGZiNzI4NDFhZWEyMDc0ZWIwMjQ1OTQucG5n?x-oss-process=image/format,png\" alt=\"img console\"></li>\n<li>为什么微信官方会仅支持以下方式进行新版canvas2d 图片的绘制，考虑是什么？</li>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JhYWQ1OWRhNDI4M2FjZmViZTY1NGQ0ZWZiNTAxZDZlMjAxMjE2LnBuZw?x-oss-process=image/format,png\" alt=\"经典报错\"></li>\n</ul>\n</li>\n<li>现在我们要将canvas的内容导成图片，同样分成新旧两版</li>\n<li>主要思路都是：在wxml中，如果canvas绘制图片没有完成，则显示canvas内容，绘制完成后，就利用canvasToTempFilePath，将图层内容生成指定大小图片，显示image<ul>\n<li>canvas2d   <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> that = <span class=\"keyword\">this</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> query = wx.createSelectorQuery().in(<span class=\"keyword\">this</span>)</span><br><span class=\"line\">   query.select(<span class=\"string\">'#myCanvas'</span>)</span><br><span class=\"line\">     .fields(&#123; <span class=\"attr\">node</span>: <span class=\"literal\">true</span>, <span class=\"attr\">size</span>: <span class=\"literal\">true</span> &#125;)</span><br><span class=\"line\">     .exec(<span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">       <span class=\"keyword\">const</span> canvas = res[<span class=\"number\">0</span>].node</span><br><span class=\"line\">       <span class=\"keyword\">const</span> ctx = canvas.getContext(<span class=\"string\">'2d'</span>)</span><br><span class=\"line\">       <span class=\"keyword\">const</span> img = canvas.createImage()</span><br><span class=\"line\">       <span class=\"built_in\">console</span>.log(<span class=\"string\">'img'</span>, img)</span><br><span class=\"line\">       img.onload = <span class=\"function\"><span class=\"params\">()</span> =&gt;</span> &#123;</span><br><span class=\"line\">         ctx.drawImage(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">           wx.canvasToTempFilePath(&#123;</span><br><span class=\"line\">             x: <span class=\"number\">0</span>,</span><br><span class=\"line\">             y: <span class=\"number\">0</span>,</span><br><span class=\"line\">             width: <span class=\"number\">100</span>,</span><br><span class=\"line\">             height: <span class=\"number\">100</span>,</span><br><span class=\"line\">             destWidth: <span class=\"number\">100</span>,</span><br><span class=\"line\">             destHeight: <span class=\"number\">100</span>,</span><br><span class=\"line\">             canvas: canvas,</span><br><span class=\"line\">             success(res) &#123;</span><br><span class=\"line\">               that.setData(&#123;</span><br><span class=\"line\">                 imgPath: res.tempFilePath</span><br><span class=\"line\">               &#125;)</span><br><span class=\"line\">             &#125;,</span><br><span class=\"line\">             fail(err) &#123;</span><br><span class=\"line\">               <span class=\"built_in\">console</span>.log(<span class=\"string\">'err'</span>, err)</span><br><span class=\"line\">             &#125;</span><br><span class=\"line\">           &#125;)</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">       img.src = <span class=\"string\">'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'</span></span><br><span class=\"line\">       <span class=\"comment\">// 这种方式获取canvas区域隐含的像素数据</span></span><br><span class=\"line\">       <span class=\"built_in\">console</span>.log(ctx.getImageData(<span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">100</span>, <span class=\"number\">100</span>).data)</span><br><span class=\"line\">     &#125;)</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">\"&#123;&#123;!imgPath&#125;&#125;\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"2d\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 330px;height: 340px;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">wx:else</span> <span class=\"attr\">src</span>=<span class=\"string\">\"&#123;&#123;imgPath&#125;&#125;\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 330px;height: 340px;\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>canvas2d 需要踩得坑是：它的官方文档🙃<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UwM2Q1ZDg0YzYyNmI0NzlmZjBjOTlmNzA1YmRhYjg5NDc5MjcucG5n?x-oss-process=image/format,png\" alt=\"canvas2d 转图片误导\"></li>\n<li>尝试下来，会<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2UxMjRiY2Q3ZmNjYWI5ODBlNDdkMTk2YTMyZGQyODI4NDUzODcucG5n?x-oss-process=image/format,png\" alt=\"ctx.draw报错\"></li>\n</ul>\n</li>\n<li>那我们可以继续往下看<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2YxODk5NWFiNDY4N2IwYmZlYzhjZTZkZWU2ZWQxYmZjMTA1MTY1LnBuZw?x-oss-process=image/format,png\" alt=\"canvas2d tempath正确实力\">这才是符合我们需要</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>运行截图<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AxLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2JmMzVlMzY4YzRjMmRhYTgxNTA0NzM0YTIxZGMxM2I2NDYwNzIucG5n?x-oss-process=image/format,png\" alt=\"canvas2d运行截图\"></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>旧版canvas  <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ctx = wx.createCanvasContext(<span class=\"string\">'myCanvas'</span>)</span><br><span class=\"line\"><span class=\"keyword\">const</span> that = <span class=\"keyword\">this</span></span><br><span class=\"line\">wx.getImageInfo(&#123;</span><br><span class=\"line\">  src: <span class=\"string\">'https://p0.meituan.net/myvideodistribute/0990cc2062e81ab6cc11fd8690f8755042005.jpg'</span>,</span><br><span class=\"line\">  success: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">res</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'res'</span>, res)</span><br><span class=\"line\">    <span class=\"keyword\">const</span> poster = res.path</span><br><span class=\"line\">    ctx.drawImage(poster, <span class=\"number\">0</span>, <span class=\"number\">0</span>, <span class=\"number\">150</span>, <span class=\"number\">100</span>)</span><br><span class=\"line\">    ctx.draw(<span class=\"literal\">false</span>, () =&gt; &#123;</span><br><span class=\"line\">      wx.canvasToTempFilePath(&#123;</span><br><span class=\"line\">        x: <span class=\"number\">0</span>,</span><br><span class=\"line\">        y: <span class=\"number\">0</span>,</span><br><span class=\"line\">        width: <span class=\"number\">100</span>,</span><br><span class=\"line\">        height: <span class=\"number\">100</span>,</span><br><span class=\"line\">        destWidth: <span class=\"number\">100</span>,</span><br><span class=\"line\">        destHeight: <span class=\"number\">100</span>,</span><br><span class=\"line\">        canvasId: <span class=\"string\">\"myCanvas\"</span>,</span><br><span class=\"line\">        success(res) &#123;</span><br><span class=\"line\">          that.setData(&#123;</span><br><span class=\"line\">            imgPath: res.tempFilePath</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(res.tempFilePath)</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\">        fail(err) &#123;</span><br><span class=\"line\">          <span class=\"built_in\">console</span>.log(<span class=\"string\">'err'</span>, err)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">// 这种方式获取canvas区域隐含的像素数据</span></span><br><span class=\"line\">    wx.canvasGetImageData(&#123;</span><br><span class=\"line\">      canvasId: <span class=\"string\">'myCanvas'</span>,</span><br><span class=\"line\">      x: <span class=\"number\">0</span>,</span><br><span class=\"line\">      y: <span class=\"number\">0</span>,</span><br><span class=\"line\">      width: <span class=\"number\">150</span>,</span><br><span class=\"line\">      height: <span class=\"number\">100</span>,</span><br><span class=\"line\">      success(res) &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res.width) <span class=\"comment\">// 150</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res.height) <span class=\"comment\">// 100</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res.data <span class=\"keyword\">instanceof</span> <span class=\"built_in\">Uint8ClampedArray</span>) <span class=\"comment\">// true</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res.data) <span class=\"comment\">// 150 * 100 * 4</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(res.data.length) <span class=\"comment\">// 150 * 100 * 4</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n  <figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">\"&#123;&#123;!imgPath&#125;&#125;\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">\"myCanvas\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 330px;height: 340px;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">image</span> <span class=\"attr\">wx:else</span> <span class=\"attr\">src</span>=<span class=\"string\">\"&#123;&#123;imgPath&#125;&#125;\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width: 330px;height: 340px;\"</span> /&gt;</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>运行截图<ul>\n<li><img src=\"https://imgconvert.csdnimg.cn/aHR0cDovL3AwLm1laXR1YW4ubmV0L215dmlkZW9kaXN0cmlidXRlL2EzZTRiYTBkYzc2NDgzYTM1NTYxZDcwNDUzNzZkNjZmNDU5MTgucG5n?x-oss-process=image/format,png\" alt=\"旧版canvas运行截图\"><h4 id=\"写在后面\"><a href=\"#写在后面\" class=\"headerlink\" title=\"写在后面\"></a>写在后面</h4></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>感谢<a href=\"https://github.com/skadieyes\" target=\"_blank\" rel=\"noopener\">Skady宝贝</a>在探讨问题中给予的帮助，欢迎大家去github找她玩👈</li>\n<li>祝大家多多发财</li>\n</ul>\n<hr>\n"}],"PostAsset":[],"PostCategory":[{"post_id":"ck8micb6p0000vnp33y4s5kfe","category_id":"ck8mieyr10000xbp37i8baz0y","_id":"ck8mieyr40001xbp37tcg4ooc"},{"post_id":"ck8mivy7t0000dvp38a1j7n56","category_id":"ck8mieyr10000xbp37i8baz0y","_id":"ck8mivy830002dvp3dutedtvp"}],"PostTag":[{"post_id":"ck8micb6p0000vnp33y4s5kfe","tag_id":"ck8micb6z0001vnp37ybyh36h","_id":"ck8micb710002vnp31wiz2w23"},{"post_id":"ck8mivy7t0000dvp38a1j7n56","tag_id":"ck8micb6z0001vnp37ybyh36h","_id":"ck8mivy830001dvp33a6t5t9q"}],"Tag":[{"name":"微信小程序","_id":"ck8micb6z0001vnp37ybyh36h"}]}}